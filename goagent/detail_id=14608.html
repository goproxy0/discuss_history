



<!DOCTYPE html>
<html>
<head>
 <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" >
 <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" >
 
 <meta name="ROBOTS" content="NOARCHIVE">
 
 <link rel="icon" type="image/vnd.microsoft.icon" href="https://ssl.gstatic.com/codesite/ph/images/phosting.ico">
 
 
 <script type="text/javascript">
 
 
 
 
 var codesite_token = null;
 
 
 var CS_env = {"domainName": null, "projectName": "goagent", "token": null, "projectHomeUrl": "/p/goagent", "relativeBaseUrl": "", "loggedInUserEmail": null, "assetHostPath": "https://ssl.gstatic.com/codesite/ph", "assetVersionPath": "https://ssl.gstatic.com/codesite/ph/10671232128890609530", "profileUrl": null};
 var _gaq = _gaq || [];
 _gaq.push(
 ['siteTracker._setAccount', 'UA-18071-1'],
 ['siteTracker._trackPageview']);
 
 (function() {
 var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
 ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
 (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(ga);
 })();
 
 </script>
 
 
 <title>Issue 14608 - 
 goagent -
 
 GoAgent的安全风险 - 
 https://github.com/goagent/goagent - Google Project Hosting
 </title>
 <link type="text/css" rel="stylesheet" href="https://ssl.gstatic.com/codesite/ph/10671232128890609530/css/core.css">
 
 <link type="text/css" rel="stylesheet" href="https://ssl.gstatic.com/codesite/ph/10671232128890609530/css/ph_detail.css" >
 
 
 
 
<!--[if IE]>
 <link type="text/css" rel="stylesheet" href="https://ssl.gstatic.com/codesite/ph/10671232128890609530/css/d_ie.css" >
<![endif]-->
 <style type="text/css">
 .menuIcon.off { background: no-repeat url(https://ssl.gstatic.com/codesite/ph/images/dropdown_sprite.gif) 0 -42px }
 .menuIcon.on { background: no-repeat url(https://ssl.gstatic.com/codesite/ph/images/dropdown_sprite.gif) 0 -28px }
 .menuIcon.down { background: no-repeat url(https://ssl.gstatic.com/codesite/ph/images/dropdown_sprite.gif) 0 0; }
 
 
 .attachments { width:33%; border-top:2px solid #999; padding-top: 3px; margin-left: .7em;}
 .attachments table { margin-bottom: 0.75em; }
 .attachments table tr td { padding: 0; margin: 0; font-size: 95%; }
 .preview { border: 2px solid #c3d9ff; padding: 1px; }
 .preview:hover { border: 2px solid blue; }
 .label { white-space: nowrap; }
 .derived { font-style:italic }
 .cursor_on .author {
 background: url(https://ssl.gstatic.com/codesite/ph/images/show-arrow.gif) no-repeat 2px;
 }
 .hiddenform {
 display: none;
 }

 
 </style>
</head>
<body class="t3">
<script type="text/javascript">
 window.___gcfg = {lang: 'en'};
 (function() 
 {var po = document.createElement("script");
 po.type = "text/javascript"; po.async = true;po.src = "https://apis.google.com/js/plusone.js";
 var s = document.getElementsByTagName("script")[0];
 s.parentNode.insertBefore(po, s);
 })();
</script>
<div class="headbg">

 <div id="gaia">
 

 <span>
 
 
 <a href="#" id="projects-dropdown" onclick="return false;"><u>My favorites</u> <small>&#9660;</small></a>
 | <a href="https://www.google.com/accounts/ServiceLogin?service=code&amp;ltmpl=phosting&amp;continue=https%3A%2F%2Fcode.google.com%2Fp%2Fgoagent%2Fissues%2Fdetail%3Fid%3D14608&amp;followup=https%3A%2F%2Fcode.google.com%2Fp%2Fgoagent%2Fissues%2Fdetail%3Fid%3D14608" onclick="_CS_click('/gb/ph/signin');"><u>Sign in</u></a>
 
 </span>

 </div>

 <div class="gbh" style="left: 0pt;"></div>
 <div class="gbh" style="right: 0pt;"></div>
 
 
 <div style="height: 1px"></div>
<!--[if lte IE 7]>
<div style="text-align:center;">
Your version of Internet Explorer is not supported. Try a browser that
contributes to open source, such as <a href="http://www.firefox.com">Firefox</a>,
<a href="http://www.google.com/chrome">Google Chrome</a>, or
<a href="http://code.google.com/chrome/chromeframe/">Google Chrome Frame</a>.
</div>
<![endif]-->



 <table style="padding:0px; margin: 0px 0px 10px 0px; width:100%" cellpadding="0" cellspacing="0"
 itemscope itemtype="http://schema.org/CreativeWork">
 <tr style="height: 58px;">
 
 
 
 <td id="plogo">
 <link itemprop="url" href="/p/goagent">
 <a href="/p/goagent/">
 
 <img src="https://ssl.gstatic.com/codesite/ph/images/defaultlogo.png" alt="Logo" itemprop="image">
 
 </a>
 </td>
 
 <td style="padding-left: 0.5em">
 
 <div id="pname">
 <a href="/p/goagent/"><span itemprop="name">goagent</span></a>
 </div>
 
 <div id="psum">
 <a id="project_summary_link"
 href="/p/goagent/"><span itemprop="description">https://github.com/goagent/goagent</span></a>
 
 </div>
 
 
 </td>
 <td style="white-space:nowrap;text-align:right; vertical-align:bottom;">
 
 <form action="/hosting/search">
 <input size="30" name="q" value="" type="text">
 
 <input type="submit" name="projectsearch" value="Search projects" >
 </form>
 
 </tr>
 </table>

</div>

 
<div id="mt" class="gtb"> 
 <a href="/p/goagent/" class="tab ">Project&nbsp;Home</a>
 
 
 
 
 
 
 
 
 <a href="/p/goagent/issues/list"
 class="tab active">Issues</a>
 
 
 
 
 
 
 
 
 
 
 <a href="https://code.google.com/export-to-github/export?project=goagent">
 <button>Export to GitHub</button>
 
 </a>
 
 
 <div class=gtbc></div>
</div>

 
 <div style="font-weight: bold; color: #c00; margin-top: 5px; margin-left: 13px;">
 READ-ONLY: This project has been <a href='https://code.google.com/archive/p/goagent'>archived</a>. For more information see <a href='https://code.google.com/p/support/wiki/ReadOnlyTransition'>this post</a>.
 </div>
 

<table cellspacing="0" cellpadding="0" width="100%" align="center" border="0" class="st">
 <tr>
 
 
 
 
 
 <td class="subt">
 <div class="issueDetail">
<div class="isf">
 
 <span class="inIssueList">
 <span>Search</span>
 <form action="list" method="GET" style="display:inline">
 <select id="can" name="can">
 
<option disabled="disabled">Search within:</option>
<option value="1" >&nbsp;All issues</option>
<option value="2" selected=selected>&nbsp;Open issues</option>

<option value="6" >&nbsp;New issues</option>
<option value="7" >&nbsp;Issues to verify</option>

 </select>
 <span>for</span>
 <span id="qq"><input type="text" size="38" id="searchq" name="q"
 value="" autocomplete="off"
 
 onkeydown="_blurOnEsc(event)"></span>
 
 
 <span id="search_colspec"><input type="hidden" name="colspec" value="ID Opened Reporter Modified Summary Stars" ></span>
 
 
 
 <input type="hidden" name="cells" value="tiles" >
 <input type="submit" value="Search">
 </form>
 </span> &nbsp;
 <span class="inIssueAdvSearch">
 <a href="advsearch">Advanced search</a>
 </span> &nbsp;
 <span class="inIssueSearchTips">
 <a href="searchtips">Search tips</a>
 </span> &nbsp;
 <span class="inIssueSubscriptions">
 <a href="/p/goagent/issues/subscriptions">Subscriptions</a>
 </span>
</div>
</div>
 </td>
 
 
 
 
 <td align="right" valign="top" class="bevel-right"></td>
 </tr>
</table>


<script type="text/javascript">
 var cancelBubble = false;
 function _go(url) { document.location = url; }
</script>
<div id="maincol"
 
>

 






 

 

 

 

 

 

 

 

 

 

 

 


 

<div id="color_control" class="">
<div id="issueheader">
<table cellpadding="0" cellspacing="0" width="100%"><tbody>
 <tr>
 <td class="vt h3" nowrap="nowrap" style="padding:0 5px">
 
 
 Issue <a href="detail?id=14608">14608</a>:
 </td>
 <td width="90%" class="vt">
 <span class="h3" >GoAgent的安全风险</span>
 </td>
 <td>
 
 </td>
 </tr>
 <tr>
 <td></td>
 <td nowrap="nowrap">
 
 
 7 people starred this issue and may be notified of changes.
 
 
 
 </td>
 <td align="center" nowrap="nowrap">
 
 <a href="https://code.google.com/p/goagent/issues/list?cursor=goagent%3A14608">Back to list</a>
 
 </td>
 </tr>
 
</tbody></table>
</div>
<table width="100%" cellpadding="0" cellspacing="0" border="0" class="issuepage" id="meta-container">
<tbody class="collapse"> 
 <tr>
 <td id="issuemeta">
 <div id="meta-float">
 
<table cellspacing="0" cellpadding="0">
 <tr><th align="left">Status:&nbsp;</th>
 <td width="100%">
 
 <span title="Issue has not had initial review yet">New</span>
 
 </td>
 </tr>
 
 
 
 
 <tr><th align="left">Owner:&nbsp;</th><td>
 
 
 ----
 
 
 </td>
 </tr>
 
 
 
 <tr><td colspan="2">
 
 
 
 <div style="padding-top:2px">
 
 <a href="list?q=label:Type-Defect"
 title="Report of a software defect"
 class="label"><b>Type-</b>Defect</a>
 
 </div>
 
 
 
 
 <div style="padding-top:2px">
 
 <a href="list?q=label:Priority-Medium"
 title="Normal priority"
 class="label"><b>Priority-</b>Medium</a>
 
 </div>
 
 
 </td></tr>
 
</table>
<div class="rel_issues">
 
 
 
</div>


 <br><br>
 


 
 </div>&nbsp;
 </td>
 <td class="vt issuedescription" width="100%" id="cursorarea" >
 
<div class="cursor_off vt issuedescription" id="hc0">
 
 
 <div class="author">
 
 Reported by
 

 <a class="userlink"
 href="/u/108113986212772662294/">wangjian...@gmail.com</a
>,
 <span class="date" title="Fri Jun 13 12:31:10 2014">Jun 13, 2014</span>
 
 </div>
<pre>
月光博客  by 投稿 (guest) Jun 12
　　GoAgent 利用 Google App Engine (GAE) 来实现安全上网，以免费、快速、稳定的特点深受网民的欢迎。但是，GoAgent 的安装和配置中存在两点严重安全风险的问题却鲜为人知。这两点安全风险都可能被攻击者利用进行 “中间人攻击（man-in-the-middle attack）” 来窃取 GoAgent 用户的网络帐号密码等敏感信息，其概括描述如下：

GoAgent 在启动时会尝试自动往系统的可信根证书中导入一个名为 “GoAgent CA” 的证书。由于这个证书的私钥是公开的，导致任何人都可以利用这个私钥来伪造任意网站的证书进行 HTTPS 中间人攻击。即使在不开启 GoAgent 时，这种攻击的风险仍然存在。换而言之，一旦这个证书被导入，攻击者可以用此绕过几乎所有网站的 HTTPS 保护。
GoAgent 本身对 TLS 证书的认证存在问题，而且默认时不对证书进行检查，这导致在使用 GoAgent 时存在 HTTPS 中间人攻击的风险。
　　事实上曾经有用户在 GoAgent 主页上的问题跟踪列表中指出了这两个安全问题（见以下链接），但既没有修复也没有广泛公开，多数用户，尤其是非中文用户可能并不知情。下面是这两个问题的详细解释。

<a href="https://code.google.com/p/goagent/issues/detail?id=11091" rel="nofollow">https://code.google.com/p/goagent/issues/detail?id=11091</a>
<a href="https://code.google.com/p/goagent/issues/detail?id=8031" rel="nofollow">https://code.google.com/p/goagent/issues/detail?id=8031</a>
　　GoAgent 导入公开私钥根证书的问题

　　GoAgent 在启动时会尝试在系统中导入一个根证书来避免访问 HTTPS 网站时的证书报警，但在默认情况下所导入证书的私钥是公开的。因为私钥公开，任何人可以作为 “GoAgent CA” 来签发任何网站的证书。即使在 GoAgent 没有启动甚至卸载的情况下，这个公钥仍会遗留在系统中。在有些系统中，GoAgent 所导入的根证书不仅被 GoAgent 默认使用的浏览器信任，其他的浏览器也可能会信任这一根证书，从而受到这一问题的影响。

　　GoAgent 所导入的这一公开私钥根证书的指纹是：

SHA1 Fingerprint=AB:70:2C:DF:18:EB:E8:B4:38:C5:28:69:CD:4A:5D:EF:48:B4:0E:33MD5 Fingerprint=56:B1:20:86:1B:0A:B0:61:38:00:1B:C3:67:CF:0C:CC
　　包含这一 “GoAgent CA” 证书以其私钥（文件中 -----BEGIN RSA PRIVATE KEY----- 位置）的文件 URL 为：

<a href="https://github.com/goagent/goagent/blob/c4386808ea943e2ebed25f1e5264943354e3f9cb/local/CA.crt" rel="nofollow">https://github.com/goagent/goagent/blob/c4386808ea943e2ebed25f1e5264943354e3f9cb/local/CA.crt</a>
　　根据版本信息，这一证书和私钥从 2011 年 6 月甚至更早的时间以来一直保持不变。

<a href="https://github.com/goagent/goagent/blob/fa9959e577395e48a477fd5495afbc2363a51baa/local/CA.key" rel="nofollow">https://github.com/goagent/goagent/blob/fa9959e577395e48a477fd5495afbc2363a51baa/local/CA.key</a>
　　GoAgent 主要包含两个部分：一个在用户计算机上运行的本地代理程序 proxy.py，以及一个在 GAE 上运行的远程代理程序 gae.py。

<a href="https://github.com/goagent/goagent/blob/c4386808ea943e2ebed25f1e5264943354e3f9cb/local/proxy.py" rel="nofollow">https://github.com/goagent/goagent/blob/c4386808ea943e2ebed25f1e5264943354e3f9cb/local/proxy.py</a>
<a href="https://github.com/goagent/goagent/blob/c4386808ea943e2ebed25f1e5264943354e3f9cb/server/gae/gae.py" rel="nofollow">https://github.com/goagent/goagent/blob/c4386808ea943e2ebed25f1e5264943354e3f9cb/server/gae/gae.py</a>
　　安装时，用户需要上传 gae.py 到 GAE。用户浏览器通过设置一个本地代理将 HTTP/HTTPS 请求转发到 proxy.py，再由 proxy.py 和 gae.py 进行通信。

　　默认情况下，GoAgent 在启动时试图导入上述 GoAgent CA 证书。具体的代码为 proxy.py 中的 CertUtil.import_ca：

<a href="https://github.com/goagent/goagent/blob/c4386808ea943e2ebed25f1e5264943354e3f9cb/local/proxy.py#L337" rel="nofollow">https://github.com/goagent/goagent/blob/c4386808ea943e2ebed25f1e5264943354e3f9cb/local/proxy.py#L337</a>
　　这个函数会根据用户操作系统通过不同的方式尝试导入证书，在某些情况下会需要管理员（root/administrator）权限。在 Windows 下，这个函数会调用 CertAddEncodedCertificateToStore 这一 API。在 OS X 下，会尝试执行系统命令

security find-certificate -a -c &quot;GoAgent&quot; | grep &quot;GoAgent&quot; &gt;/dev/null || security add-trusted-cert -d -r trustRoot -k &quot;/Library/Keychains/System.keychain&quot; &quot;pwd/CA.crt&quot;
　　在 Ubuntu 下，会拷贝证书文件到 /usr/local/share/ca-certificates 然后执行 update-ca-certificates。在其他 GNU/Linux 发行版中，会尝试执行以下命令更改 NSS 数据库：

certutil -L -d sql:$HOME/.pki/nssdb | grep &quot;GoAgent&quot; || certutil -d sql:$HOME/.pki/nssdb -A -t &quot;C,,&quot; -n &quot;GoAgent&quot; -i &quot;pwd/CA.crt&quot;
　　由于 Firefox 采用了不同的方式存储证书，这一自动安装过程不会导入 GoAgent CA 证书到 Firefox 中。但是 GoAgent 的安装指南和 FAQ 中说明了如何手动导入这一证书：

<a href="https://code.google.com/p/goagent/wiki/InstallGuide" rel="nofollow">https://code.google.com/p/goagent/wiki/InstallGuide</a>
<a href="https://code.google.com/p/goagent/wiki/FAQ" rel="nofollow">https://code.google.com/p/goagent/wiki/FAQ</a>
　　这一证书随后被 proxy.py 用来作为 HTTPS 中间人来避免浏览器在访问 HTTPS 网站时出现报警。GoAgent 的工作原理如下：首先 proxy.py 将浏览器的 HTTP 请求进行编码并转发给 gae.py，gae.py 完成收到的请求然后将结果进行编码后返回给 proxy.py，最后 proxy.py 将结果转发给浏览器来完成 “翻墙” 过程。由于 GAE 的限制 （免费 app 无法使用 socket 接口），对于 HTTPS 请求，proxy.py 无法进行透明转发，只能作为中间人先和浏览器完成连接，然后获得其中的明文请求以后在转发给 gae.py。当收到 CONNECT 请求（这意味着浏览器正在浏览一个 HTTPS 网站）， proxy.py 首先利用 GoAgent CA 签发一个假的证书来和浏览器完成握手，从用户的角度，所有的 HTTPS 网站的证书都是由事先导入的 “GoAgent CA” 认证的，所以不会报警。有些浏览器会对少数网站的证书进行特别的检查（Certificate Pinning），这种情况下 &quot;GoAgent CA” 所签发的证书可能会触发证书不安全的报警。GoAgent 的这种工作方式导致 HTTPS 不再是浏览器到网站的端到端安全通信，而变成了 proxy.py 到 GAE，以及 GAE 到网站两段独立的 HTTPS 连接，GAE 能够看到请求和应答的明文。

GoAgent的安全风险

GoAgent的安全风险

　　测试页面

　　请访问

<a href="https://goagent-cert-test.bamsoftware.com/" rel="nofollow">https://goagent-cert-test.bamsoftware.com/</a>
　　来进行测试。这个页面使用了一个由 GoAgent CA 签发的证书。如果你的浏览器没有受到影响，会显示报警信息；如果没有看到报警，则表明你的浏览器导入了公开的 GoAgent CA 证书，存在严重安全风险。

　　如何防止风险

　　GoAgent 本身带有生成证书文件 CA.crt 的功能。只需要删除 local/CA.crt 文件就能保证 GoAgent 所导入的证书是唯一的，不会被网络上的攻击者利用来进行攻击。

　　下面的 “补丁（patch）” 文件会帮助你从 GoAgent 的 git 仓库中删除 CA.crt 文件，请下载补丁文件并执行以下命令： git am 0001-Remove-static-CA.crt.patch. 如果你不是通过 git 获得 GoAgent（例如直接从 <a href="https://code.google.com/p/goagent/" rel="nofollow">https://code.google.com/p/goagent/</a> 上的链接下载得到），请手动删除 local/CA.crt 文件。

0001-Remove-static-CA.crt.patch
　　如果你以前曾经使用过 GoAgent，务必要检查系统中任何可能的地方，删除 SHA-1 指纹为 AB:70:2C:DF:18:EB:E8:B4:38:C5:28:69:CD:4A:5D:EF:48:B4:0E:33 的 “GoAgent CA” 证书（建议使用浏览器访问上面的测试页面进行检查）。下面说明在常见系统中检查和删除 GoAgent CA 证书的方法。

　　如何删除 GoAgent CA 证书

　　Firefox 中，打开 “preferences”，”Advanced”, “Certificates”, “View Certificates”, “Authorities”，然后在证书列表中找到 “GoAgent CA”，选中并点击 “Delete or Distrust...” 按钮，然后确认。

GoAgent的安全风险

　　Ubuntu 下，删除 /usr/local/share/ca-certificates/GoAgent.crt 然后执行

update-ca-certificates --fresh
　　Windows 下，请参考以下链接：

<a href="http://technet.microsoft.com/en-us/library/cc754841.aspx#BKMK_addlocal" rel="nofollow">http://technet.microsoft.com/en-us/library/cc754841.aspx#BKMK_addlocal</a>
　　中 &quot;Adding certificates to the Trusted Root Certification Authorities store for a local computer&quot; 的步骤，但是在 step 8 时右键选中 &quot;GoAgent CA&quot; 然后选择 &quot;Delete&quot;。

GoAgent的安全风险

　　在 Mac OS X下，打开 “Keychain Access” 应用，点击锁图标并输入密码解锁。在边上的控制面板中，选择 &quot;System&quot; 以及 &quot;Certificates&quot;，选中 &quot;GoAgent CA&quot; 然后按 “Delete” 键，点击 &quot;Delete&quot; 按钮并输入你的密码确认。

GoAgent的安全风险

　　GoAgent 没有进行正确的 TLS 验证，存在中间人攻击的风险

　　默认情况下，GoAgent 会通过 HTTPS 来保护本地 proxy.py 和 GAE 服务器上的 gae.py 之间的通信 （在配置文件 proxy.ini 中相关的设置默认为 gae.mode=https）。但是同样在默认情况下，GoAgent 不会要求对 GAE 服务器的证书进行验证（gae.validate=0），这导致本地 proxy.py 和 App Engine 服务器之间的通信存在 HTTPS 中间人攻击的风险。此外， gae.validate 配置项同样控制 App Engine 上的 gae.py 是否对网站服务器的证书进行验证，默认配置下这一配置为 0 导致 gae.py 也不会对网站证书进行验证，使得 gae.py 和网站之间的通信同样存在 HTTPS 中间人攻击的风险

　　即使修改配置启用证书验证（gae.validate=1），GoAgent 对 App Engine 服务器证书的验证也并不严格：在 proxy.py 中只是对证书的 organizationName 进行了粗略的检查（是否为 “Google ” 开头），而没有对主机名（hostname）进行匹配。

<a href="https://github.com/goagent/goagent/blob/c4386808ea943e2ebed25f1e5264943354e3f9cb/local/proxy.py#L1623" rel="nofollow">https://github.com/goagent/goagent/blob/c4386808ea943e2ebed25f1e5264943354e3f9cb/local/proxy.py#L1623</a>
　　将配置改为 gae.validate=1 同时会启用 gae.py 段对网站服务器证书的验证，这部分的事先没有明显的问题。

<a href="https://github.com/goagent/goagent/blob/c4386808ea943e2ebed25f1e5264943354e3f9cb/server/gae/gae.py#L184" rel="nofollow">https://github.com/goagent/goagent/blob/c4386808ea943e2ebed25f1e5264943354e3f9cb/server/gae/gae.py#L184</a>
　　GoAgent 还提供了一个可选功能，通过 RC4 和一个共享密钥来对 proxy.py 和 gae.py 之间的数据进行进一步的混淆。启用这一功能需要在 proxy.ini 中设置 gae.password，以及 gae.options=rc4，并在 gae.py 中设置 __password__ 变量。

<a href="https://github.com/goagent/goagent/blob/c4386808ea943e2ebed25f1e5264943354e3f9cb/server/gae/gae.py#L5" rel="nofollow">https://github.com/goagent/goagent/blob/c4386808ea943e2ebed25f1e5264943354e3f9cb/server/gae/gae.py#L5</a>
　　但是，这里的 RC4 加密只能起到一个简单的混淆作用，无法在不启用 HTTPS 的情况下利用这一功能来防止中间人攻击。GoAgent 中的 RC4 无法实现数据的机密性，因为密码本身会通过一个 G-password 头在 proxy.py 和 gae.py 中传送，而且在两段通信中会使用同样的密码流（keystream），导致攻击者很容易通过密文的 XOR 操作来获得 XOR 过的明文（见流密码的重用问题，Stream Cipher Key Reuse），进而得到明文。在这里 RC4 只能起到防止其他 GoAgent 用户共享服务端流量的目的，无法提供更多的保护来防止网络攻击。

　　如何防止风险

　　确认在 proxy.ini 中设置了 gae.mode=https （默认），并且启用了证书验证 gae.validate=1（非默认）。这样的设定基本上能够防止 proxy.py 和 GAE 服务器，以及 GAE 服务器和网站服务器之间的 HTTPS 中间人攻击。由于 proxy.py 中没有对证书的主机名进行严格匹配，proxy.py 和 GAE 服务器的通信仍存在（相对较小的）风险，如果有人能够申请到 organizationName 字段以 “Google ” 开头的证书，仍然能够成功进行HTTPS 中间人攻击。

　　来源：bamsoftware，原文链接。

评论《GoAgent的安全风险》的内容...

相关文章:

使用Chroot解决PHP的运行安全问题
小米论坛用户数据遭泄漏
OpenSSL曝重大安全漏洞
DNS攻击原理与防范
个人网站服务器防火墙软件评测

微博：新浪微博 - 微信公众号：williamlonginfo 
月光博客投稿信箱：williamlong.info(at)gmail.com
Created by William Long www.williamlong.info

</pre>

</div>

 


 
 
 
 
 <div class="cursor_off vt issuecomment"
 id="hc1">
 <div style="float:right; margin-right:.3em; text-align:right">
 <span class="date" title="Fri Jun 13 13:13:19 2014">
 Jun 13, 2014
 </span>
 
 
 </div>
 
 
 
 
 
 
 
 
 
 
 <span class="author">
 
 <a name="c1" href="/p/goagent/issues/detail?id=14608#c1">#1</a>
 

 <a class="userlink"
 href="/u/104502772223713371233/">raremonk...@gmail.com</a
></span>
 
<pre>
goagent证书删除了那还能https上网吗？
文章太专业了，好多地方看不懂
</pre>
 
 
 </div>
 

 
 
 
 
 <div class="cursor_off vt issuecomment"
 id="hc2">
 <div style="float:right; margin-right:.3em; text-align:right">
 <span class="date" title="Wed Jun 10 16:25:48 2015">
 Jun 10, 2015
 </span>
 
 
 </div>
 
 
 
 
 
 
 
 
 
 
 <span class="author">
 
 <a name="c2" href="/p/goagent/issues/detail?id=14608#c2">#2</a>
 

 <a class="userlink"
 href="/u/102300648489126678681/">linhaico...@gmail.com</a
></span>
 
<pre>
额。。好详细呀
</pre>
 
 
 </div>
 

 
 
 
 
 <div class="cursor_off vt issuecomment"
 id="hc3">
 <div style="float:right; margin-right:.3em; text-align:right">
 <span class="date" title="Wed Jun 10 17:05:23 2015">
 Jun 10, 2015
 </span>
 
 
 </div>
 
 
 
 
 
 
 
 
 
 
 <span class="author">
 
 <a name="c3" href="/p/goagent/issues/detail?id=14608#c3">#3</a>
 

 <a class="userlink"
 href="/u/103449757786467151960/">gzc19890...@gmail.com</a
></span>
 
<pre>
我的proxy.ini中没有gae.mode和gae.validate
</pre>
 
 
 </div>
 

 
 
 
 
 <div class="cursor_off vt issuecomment"
 id="hc4">
 <div style="float:right; margin-right:.3em; text-align:right">
 <span class="date" title="Wed Jun 10 17:07:06 2015">
 Jun 10, 2015
 </span>
 
 
 </div>
 
 
 
 
 
 
 
 
 
 
 <span class="author">
 
 <a name="c4" href="/p/goagent/issues/detail?id=14608#c4">#4</a>
 

 <a class="userlink"
 href="/u/116642018264006539699/">agrochem...@gmail.com</a
></span>
 
<pre>
请问楼主，会不会发生1楼所说的问题？请明示！
</pre>
 
 
 </div>
 

 
 
 
 
 <div class="cursor_off vt issuecomment"
 id="hc5">
 <div style="float:right; margin-right:.3em; text-align:right">
 <span class="date" title="Wed Jun 10 19:10:35 2015">
 Jun 10, 2015
 </span>
 
 
 </div>
 
 
 
 
 
 
 
 
 
 
 <span class="author">
 
 <a name="c5" href="/p/goagent/issues/detail?id=14608#c5">#5</a>
 

 <a class="userlink"
 href="/u/115938153471716346087/">jins...@gmail.com</a
></span>
 
<pre>
文章仔细看完了，非常不错，已经按照文章设置了。
#1和#4  证书先删除，包括goagent\local文件夹下的CA证书，然后以管理员运行goagent会自动生成一个唯一证书。
</pre>
 
 
 </div>
 

 
 
 
 
 <div class="cursor_off vt issuecomment"
 id="hc6">
 <div style="float:right; margin-right:.3em; text-align:right">
 <span class="date" title="Wed Jun 10 19:26:30 2015">
 Jun 10, 2015
 </span>
 
 
 </div>
 
 
 
 
 
 
 
 
 
 
 <span class="author">
 
 <a name="c6" href="/p/goagent/issues/detail?id=14608#c6">#6</a>
 

 <a class="userlink"
 href="/u/115544407951689275697/">softlyg...@gmail.com</a
></span>
 
<pre>
新版本的goagent已经没这个问题了，下载来的目录没有证书，运行的时候才生成的
</pre>
 
 
 </div>
 

 
 
 
 
 <div class="cursor_off vt issuecomment"
 id="hc7">
 <div style="float:right; margin-right:.3em; text-align:right">
 <span class="date" title="Thu Jun 11 07:26:51 2015">
 Jun 11, 2015
 </span>
 
 
 </div>
 
 
 
 
 
 
 
 
 
 
 <span class="author">
 
 <a name="c7" href="/p/goagent/issues/detail?id=14608#c7">#7</a>
 

 <a class="userlink"
 href="/u/116244585572530425602/">rasygr...@gmail.com</a
></span>
 
<pre>
由于 proxy.py 中没有对证书的主机名进行严格匹配，proxy.py 和 GAE 服务器的通信仍存在（相对较小的）风险，如果有人能够申请到 organizationName 字段以 “Google ” 开头的证书，仍然能够成功进行HTTPS 中间人攻击。
============================================
我关心的是这个。现在有没有改善呢？
</pre>
 
 
 </div>
 

 
 
 
 
 <div class="cursor_off vt issuecomment"
 id="hc8">
 <div style="float:right; margin-right:.3em; text-align:right">
 <span class="date" title="Thu Jun 11 07:58:10 2015">
 Jun 11, 2015
 </span>
 
 
 </div>
 
 
 
 
 
 
 
 
 
 
 <span class="author">
 
 <a name="c8" href="/p/goagent/issues/detail?id=14608#c8">#8</a>
 

 <a class="userlink"
 href="/u/100482423191068116314/">cqjd2...@gmail.com</a
></span>
 
<pre>
在虚拟机翻墙的我是不是应该飘过
</pre>
 
 
 </div>
 

 
 
 
 
 <div class="cursor_off vt issuecomment"
 id="hc9">
 <div style="float:right; margin-right:.3em; text-align:right">
 <span class="date" title="Thu Jun 11 08:06:45 2015">
 Jun 11, 2015
 </span>
 
 
 </div>
 
 
 
 
 
 
 
 
 
 
 <span class="author">
 
 <a name="c9" href="/p/goagent/issues/detail?id=14608#c9">#9</a>
 

 <a class="userlink"
 href="/u/100482423191068116314/">cqjd2...@gmail.com</a
></span>
 
<pre>
当时在主机翻墙的时候就担心这个问题,于是把主机浏览器所有证书清零,然后移步虚拟机了
</pre>
 
 
 </div>
 

 
 
 
 
 <div class="cursor_off vt issuecomment"
 id="hc10">
 <div style="float:right; margin-right:.3em; text-align:right">
 <span class="date" title="Thu Jun 11 08:23:42 2015">
 Jun 11, 2015
 </span>
 
 
 </div>
 
 
 
 
 
 
 
 
 
 
 <span class="author">
 
 <a name="c10" href="/p/goagent/issues/detail?id=14608#c10">#10</a>
 

 <a class="userlink"
 href="/u/107489931029987600546/">15213598...@gmail.com</a
></span>
 
<pre>
#9 在意这个的话，我电脑配置太差所以我用火狐浏览器，火狐浏览器单独翻墙用，证书全部在火狐浏览器里。
</pre>
 
 
 </div>
 

 
 
 
 
 <div class="cursor_off vt issuecomment"
 id="hc11">
 <div style="float:right; margin-right:.3em; text-align:right">
 <span class="date" title="Thu Jun 11 09:49:23 2015">
 Jun 11, 2015
 </span>
 
 
 </div>
 
 
 
 
 
 
 
 
 
 
 <span class="author">
 
 <a name="c11" href="/p/goagent/issues/detail?id=14608#c11">#11</a>
 

 <a class="userlink"
 href="/u/102300648489126678681/">linhaico...@gmail.com</a
></span>
 
<pre>
#10 goagent是自动导入的，你用的是火狐是独立证书没错，但启动goagent的时候证书已经默认被加入到系统里，不信在全局代理下，用IE你照样可以打开youtube.所以正确的做法是还是用火狐，然后将goagent证书导入到系统证书不信任的证书列表中。

可参考该篇
CNNIC证书的清除方法 -月光博客
<a href="http://www.williamlong.info/archives/4125.html" rel="nofollow">http://www.williamlong.info/archives/4125.html</a>
</pre>
 
 
 </div>
 

 
 
 
 
 <div class="cursor_off vt issuecomment"
 id="hc12">
 <div style="float:right; margin-right:.3em; text-align:right">
 <span class="date" title="Fri Jun 12 05:34:32 2015">
 Jun 12, 2015
 </span>
 
 
 </div>
 
 
 
 
 
 
 
 
 
 
 <span class="author">
 
 <a name="c12" href="/p/goagent/issues/detail?id=14608#c12">#12</a>
 

 <a class="userlink"
 href="/u/100482423191068116314/">cqjd2...@gmail.com</a
></span>
 
<pre>
cnnic没发现,倒是看见3个china trust network
</pre>
 
 
 </div>
 


 


 </td>
 </tr>

</tbody>
</table>
<br>
<script type="text/javascript" src="https://ssl.gstatic.com/codesite/ph/10671232128890609530/js/dit_scripts.js"></script>



</div> 
<form name="delcom" action="delComment.do?q=&amp;can=2&amp;groupby=&amp;sort=&amp;colspec=ID+Opened+Reporter+Modified+Summary+Stars" method="POST">
 <input type="hidden" name="sequence_num" value="">
 <input type="hidden" name="mode" value="">
 <input type="hidden" name="id" value="14608">
 <input type="hidden" name="token" value="">
</form>

<div id="helparea"></div>
<script type="text/javascript">
 _onload();
 function delComment(sequence_num, delete_mode) {
 var f = document.forms["delcom"];
 f.sequence_num.value = sequence_num;
 f.mode.value = delete_mode;
 
 f.submit();
 return false;
 }
 
 _floatMetadata();
</script>
<script type="text/javascript" src="https://ssl.gstatic.com/codesite/ph/10671232128890609530/js/kibbles.js"></script>
<script type="text/javascript">
 _setupKibblesOnDetailPage(
 'https://code.google.com/p/goagent/issues/list?cursor\x3dgoagent%3A14608',
 '/p/goagent/issues/entry',
 '',
 '',
 '', 'goagent', 14608,
 false, false, codesite_token);
</script>
 
 
 
 <script type="text/javascript" src="https://ssl.gstatic.com/codesite/ph/10671232128890609530/js/ph_core.js"></script>
 
 
 
 
</div> 

<div id="footer" dir="ltr">
 <div class="text">
 <a href="/projecthosting/terms.html">Terms</a> -
 <a href="http://www.google.com/privacy.html">Privacy</a> -
 <a href="/p/support/">Project Hosting Help</a>
 </div>
</div>
 <div class="hostedBy" style="margin-top: -20px;">
 <span style="vertical-align: top;">Powered by <a href="http://code.google.com/projecthosting/">Google Project Hosting</a></span>
 </div>

 
 


 
 </body>
</html>


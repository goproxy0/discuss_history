



<!DOCTYPE html>
<html>
<head>
 <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" >
 <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" >
 
 <meta name="ROBOTS" content="NOARCHIVE">
 
 <link rel="icon" type="image/vnd.microsoft.icon" href="https://ssl.gstatic.com/codesite/ph/images/phosting.ico">
 
 
 <script type="text/javascript">
 
 
 
 
 var codesite_token = null;
 
 
 var CS_env = {"domainName": null, "projectHomeUrl": "/p/goagent", "relativeBaseUrl": "", "assetHostPath": "https://ssl.gstatic.com/codesite/ph", "loggedInUserEmail": null, "assetVersionPath": "https://ssl.gstatic.com/codesite/ph/10671232128890609530", "token": null, "projectName": "goagent", "profileUrl": null};
 var _gaq = _gaq || [];
 _gaq.push(
 ['siteTracker._setAccount', 'UA-18071-1'],
 ['siteTracker._trackPageview']);
 
 (function() {
 var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
 ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
 (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(ga);
 })();
 
 </script>
 
 
 <title>Issue 14192 - 
 goagent -
 
 建议不要在下载的zip包中预留cert证书，我的google账号因此被盗 - 
 https://github.com/goagent/goagent - Google Project Hosting
 </title>
 <link type="text/css" rel="stylesheet" href="https://ssl.gstatic.com/codesite/ph/10671232128890609530/css/core.css">
 
 <link type="text/css" rel="stylesheet" href="https://ssl.gstatic.com/codesite/ph/10671232128890609530/css/ph_detail.css" >
 
 
 
 
<!--[if IE]>
 <link type="text/css" rel="stylesheet" href="https://ssl.gstatic.com/codesite/ph/10671232128890609530/css/d_ie.css" >
<![endif]-->
 <style type="text/css">
 .menuIcon.off { background: no-repeat url(https://ssl.gstatic.com/codesite/ph/images/dropdown_sprite.gif) 0 -42px }
 .menuIcon.on { background: no-repeat url(https://ssl.gstatic.com/codesite/ph/images/dropdown_sprite.gif) 0 -28px }
 .menuIcon.down { background: no-repeat url(https://ssl.gstatic.com/codesite/ph/images/dropdown_sprite.gif) 0 0; }
 
 
 .attachments { width:33%; border-top:2px solid #999; padding-top: 3px; margin-left: .7em;}
 .attachments table { margin-bottom: 0.75em; }
 .attachments table tr td { padding: 0; margin: 0; font-size: 95%; }
 .preview { border: 2px solid #c3d9ff; padding: 1px; }
 .preview:hover { border: 2px solid blue; }
 .label { white-space: nowrap; }
 .derived { font-style:italic }
 .cursor_on .author {
 background: url(https://ssl.gstatic.com/codesite/ph/images/show-arrow.gif) no-repeat 2px;
 }
 .hiddenform {
 display: none;
 }

 
 </style>
</head>
<body class="t3">
<script type="text/javascript">
 window.___gcfg = {lang: 'en'};
 (function() 
 {var po = document.createElement("script");
 po.type = "text/javascript"; po.async = true;po.src = "https://apis.google.com/js/plusone.js";
 var s = document.getElementsByTagName("script")[0];
 s.parentNode.insertBefore(po, s);
 })();
</script>
<div class="headbg">

 <div id="gaia">
 

 <span>
 
 
 <a href="#" id="projects-dropdown" onclick="return false;"><u>My favorites</u> <small>&#9660;</small></a>
 | <a href="https://www.google.com/accounts/ServiceLogin?service=code&amp;ltmpl=phosting&amp;continue=https%3A%2F%2Fcode.google.com%2Fp%2Fgoagent%2Fissues%2Fdetail%3Fid%3D14192&amp;followup=https%3A%2F%2Fcode.google.com%2Fp%2Fgoagent%2Fissues%2Fdetail%3Fid%3D14192" onclick="_CS_click('/gb/ph/signin');"><u>Sign in</u></a>
 
 </span>

 </div>

 <div class="gbh" style="left: 0pt;"></div>
 <div class="gbh" style="right: 0pt;"></div>
 
 
 <div style="height: 1px"></div>
<!--[if lte IE 7]>
<div style="text-align:center;">
Your version of Internet Explorer is not supported. Try a browser that
contributes to open source, such as <a href="http://www.firefox.com">Firefox</a>,
<a href="http://www.google.com/chrome">Google Chrome</a>, or
<a href="http://code.google.com/chrome/chromeframe/">Google Chrome Frame</a>.
</div>
<![endif]-->



 <table style="padding:0px; margin: 0px 0px 10px 0px; width:100%" cellpadding="0" cellspacing="0"
 itemscope itemtype="http://schema.org/CreativeWork">
 <tr style="height: 58px;">
 
 
 
 <td id="plogo">
 <link itemprop="url" href="/p/goagent">
 <a href="/p/goagent/">
 
 <img src="https://ssl.gstatic.com/codesite/ph/images/defaultlogo.png" alt="Logo" itemprop="image">
 
 </a>
 </td>
 
 <td style="padding-left: 0.5em">
 
 <div id="pname">
 <a href="/p/goagent/"><span itemprop="name">goagent</span></a>
 </div>
 
 <div id="psum">
 <a id="project_summary_link"
 href="/p/goagent/"><span itemprop="description">https://github.com/goagent/goagent</span></a>
 
 </div>
 
 
 </td>
 <td style="white-space:nowrap;text-align:right; vertical-align:bottom;">
 
 <form action="/hosting/search">
 <input size="30" name="q" value="" type="text">
 
 <input type="submit" name="projectsearch" value="Search projects" >
 </form>
 
 </tr>
 </table>

</div>

 
<div id="mt" class="gtb"> 
 <a href="/p/goagent/" class="tab ">Project&nbsp;Home</a>
 
 
 
 
 
 
 
 
 <a href="/p/goagent/issues/list"
 class="tab active">Issues</a>
 
 
 
 
 
 
 
 
 
 
 <a href="https://code.google.com/export-to-github/export?project=goagent">
 <button>Export to GitHub</button>
 
 </a>
 
 
 <div class=gtbc></div>
</div>

 
 <div style="font-weight: bold; color: #c00; margin-top: 5px; margin-left: 13px;">
 READ-ONLY: This project has been <a href='https://code.google.com/archive/p/goagent'>archived</a>. For more information see <a href='https://code.google.com/p/support/wiki/ReadOnlyTransition'>this post</a>.
 </div>
 

<table cellspacing="0" cellpadding="0" width="100%" align="center" border="0" class="st">
 <tr>
 
 
 
 
 
 <td class="subt">
 <div class="issueDetail">
<div class="isf">
 
 <span class="inIssueList">
 <span>Search</span>
 <form action="list" method="GET" style="display:inline">
 <select id="can" name="can">
 
<option disabled="disabled">Search within:</option>
<option value="1" >&nbsp;All issues</option>
<option value="2" selected=selected>&nbsp;Open issues</option>

<option value="6" >&nbsp;New issues</option>
<option value="7" >&nbsp;Issues to verify</option>

 </select>
 <span>for</span>
 <span id="qq"><input type="text" size="38" id="searchq" name="q"
 value="" autocomplete="off"
 
 onkeydown="_blurOnEsc(event)"></span>
 
 
 <span id="search_colspec"><input type="hidden" name="colspec" value="ID Opened Reporter Modified Summary Stars" ></span>
 
 
 
 <input type="hidden" name="cells" value="tiles" >
 <input type="submit" value="Search">
 </form>
 </span> &nbsp;
 <span class="inIssueAdvSearch">
 <a href="advsearch">Advanced search</a>
 </span> &nbsp;
 <span class="inIssueSearchTips">
 <a href="searchtips">Search tips</a>
 </span> &nbsp;
 <span class="inIssueSubscriptions">
 <a href="/p/goagent/issues/subscriptions">Subscriptions</a>
 </span>
</div>
</div>
 </td>
 
 
 
 
 <td align="right" valign="top" class="bevel-right"></td>
 </tr>
</table>


<script type="text/javascript">
 var cancelBubble = false;
 function _go(url) { document.location = url; }
</script>
<div id="maincol"
 
>

 






 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 


 

<div id="color_control" class="">
<div id="issueheader">
<table cellpadding="0" cellspacing="0" width="100%"><tbody>
 <tr>
 <td class="vt h3" nowrap="nowrap" style="padding:0 5px">
 
 
 Issue <a href="detail?id=14192">14192</a>:
 </td>
 <td width="90%" class="vt">
 <span class="h3" >建议不要在下载的zip包中预留cert证书，我的google账号因此被盗</span>
 </td>
 <td>
 
 </td>
 </tr>
 <tr>
 <td></td>
 <td nowrap="nowrap">
 
 
 41 people starred this issue and may be notified of changes.
 
 
 
 </td>
 <td align="center" nowrap="nowrap">
 
 <a href="https://code.google.com/p/goagent/issues/list?cursor=goagent%3A14192">Back to list</a>
 
 </td>
 </tr>
 
</tbody></table>
</div>
<table width="100%" cellpadding="0" cellspacing="0" border="0" class="issuepage" id="meta-container">
<tbody class="collapse"> 
 <tr>
 <td id="issuemeta">
 <div id="meta-float">
 
<table cellspacing="0" cellpadding="0">
 <tr><th align="left">Status:&nbsp;</th>
 <td width="100%">
 
 <span title="Issue has not had initial review yet">New</span>
 
 </td>
 </tr>
 
 
 
 
 <tr><th align="left">Owner:&nbsp;</th><td>
 
 
 ----
 
 
 </td>
 </tr>
 
 
 
 <tr><td colspan="2">
 
 
 
 <div style="padding-top:2px">
 
 <a href="list?q=label:Type-Defect"
 title="Report of a software defect"
 class="label"><b>Type-</b>Defect</a>
 
 </div>
 
 
 
 
 <div style="padding-top:2px">
 
 <a href="list?q=label:Priority-Medium"
 title="Normal priority"
 class="label"><b>Priority-</b>Medium</a>
 
 </div>
 
 
 </td></tr>
 
</table>
<div class="rel_issues">
 
 
 
</div>


 <br><br>
 


 
 </div>&nbsp;
 </td>
 <td class="vt issuedescription" width="100%" id="cursorarea" >
 
<div class="cursor_off vt issuedescription" id="hc0">
 
 
 <div class="author">
 
 Reported by
 

 <a class="userlink"
 href="/u/116383151295439244875/">xiaoma8....@gmail.com</a
>,
 <span class="date" title="Sat Jun  7 01:56:17 2014">Jun 7, 2014</span>
 
 </div>
<pre>
建议不要在下载的zip包中预留cert证书，
gae启动时会自动导入local里面的根证书，
这就产生了一个非常严重的安全性问题，
如果黑客使用此根证书颁发的证书配置在服务器，
那么就会得到app engine所使用的账号和密码。
这是非常严重的问题，导致我的adsense被盗损失惨重，并且账号也被封了。

如果local中没有证书，gae会自动生成一个唯一的在本地签名的根证书，并导入，这就避免了这个问题。
希望作者不要将证书内置。

并且请其他用户 cmd 输入certmgr.msc删除gage默认的受信任的根证书颁发机构！
</pre>

</div>

 


 
 
 
 
 <div class="cursor_off vt issuecomment"
 id="hc1">
 <div style="float:right; margin-right:.3em; text-align:right">
 <span class="date" title="Sat Jun  7 01:59:30 2014">
 Jun 7, 2014
 </span>
 
 
 </div>
 
 
 
 
 
 
 
 
 
 
 <span class="author">
 
 <a name="c1" href="/p/goagent/issues/detail?id=14192#c1">#1</a>
 

 <a class="userlink"
 href="/u/111417774546691146193/">fgo...@gmail.com</a
></span>
 
<pre>
使用预留证书并且使用adsense的人，成千上万。 
目前就看到你一个人说这个，等待其他用户反映。
</pre>
 
 
 </div>
 

 
 
 
 
 <div class="cursor_off vt issuecomment"
 id="hc2">
 <div style="float:right; margin-right:.3em; text-align:right">
 <span class="date" title="Sat Jun  7 02:01:41 2014">
 Jun 7, 2014
 </span>
 
 
 </div>
 
 
 
 
 
 
 
 
 
 
 <span class="author">
 
 <a name="c2" href="/p/goagent/issues/detail?id=14192#c2">#2</a>
 

 <a class="userlink"
 href="/u/107383702792451430105/">mang...@gmail.com</a
></span>
 
<pre>
关注。。。。看看具体事情发展情况。
</pre>
 
 
 </div>
 

 
 
 
 
 <div class="cursor_off vt issuecomment"
 id="hc3">
 <div style="float:right; margin-right:.3em; text-align:right">
 <span class="date" title="Sat Jun  7 02:04:39 2014">
 Jun 7, 2014
 </span>
 
 
 </div>
 
 
 
 
 
 
 
 
 
 
 <span class="author">
 
 <a name="c3" href="/p/goagent/issues/detail?id=14192#c3">#3</a>
 

 <a class="userlink"
 href="/u/116383151295439244875/">xiaoma8....@gmail.com</a
></span>
 
<pre>
使用预留证书并且使用adsense的人，成千上万，但是大部分都只是单独注册账号用来FQ的。
我的gg账号不仅用在gae，还有gmail，adsense等。其他人账号盗了对盗号者没意义啊。
</pre>
 
 
 </div>
 

 
 
 
 
 <div class="cursor_off vt issuecomment"
 id="hc4">
 <div style="float:right; margin-right:.3em; text-align:right">
 <span class="date" title="Sat Jun  7 02:08:07 2014">
 Jun 7, 2014
 </span>
 
 
 </div>
 
 
 
 
 
 
 
 
 
 
 <span class="author">
 
 <a name="c4" href="/p/goagent/issues/detail?id=14192#c4">#4</a>
 

 <a class="userlink"
 href="/u/116383151295439244875/">xiaoma8....@gmail.com</a
></span>
 
<pre>
<a href="http://m.zhihu.com/question/20091633" rel="nofollow">http://m.zhihu.com/question/20091633</a>
</pre>
 
 
 </div>
 

 
 
 
 
 <div class="cursor_off vt issuecomment"
 id="hc5">
 <div style="float:right; margin-right:.3em; text-align:right">
 <span class="date" title="Sat Jun  7 02:08:43 2014">
 Jun 7, 2014
 </span>
 
 
 </div>
 
 
 
 
 
 
 
 
 
 
 <span class="author">
 
 <a name="c5" href="/p/goagent/issues/detail?id=14192#c5">#5</a>
 

 <a class="userlink"
 href="/u/116383151295439244875/">xiaoma8....@gmail.com</a
></span>
 
<pre>
我找到类似的文章了！各位请看：<a href="http://www.backlion.com/googel%E4%BB%A3%E7%90%86%EF%BC%88goagent%E6%BC%8F%E6%B4%9E%E5%AF%BC%E8%87%B4%E4%B8%AD%E9%97%B4%E4%BA%BA%E6%94%BB%E5%87%BB/" rel="nofollow">http://www.backlion.com/googel%E4%BB%A3%E7%90%86%EF%BC%88goagent%E6%BC%8F%E6%B4%9E%E5%AF%BC%E8%87%B4%E4%B8%AD%E9%97%B4%E4%BA%BA%E6%94%BB%E5%87%BB/</a>
</pre>
 
 
 </div>
 

 
 
 
 
 <div class="cursor_off vt issuecomment"
 id="hc6">
 <div style="float:right; margin-right:.3em; text-align:right">
 <span class="date" title="Sat Jun  7 02:11:54 2014">
 Jun 7, 2014
 </span>
 
 
 </div>
 
 
 
 
 
 
 
 
 
 
 <span class="author">
 
 <a name="c6" href="/p/goagent/issues/detail?id=14192#c6">#6</a>
 

 <a class="userlink"
 href="/u/111417774546691146193/">fgo...@gmail.com</a
></span>
 
<pre>
作者估计不会回复。 我又阴谋论了。
</pre>
 
 
 </div>
 

 
 
 
 
 <div class="cursor_off vt issuecomment"
 id="hc7">
 <div style="float:right; margin-right:.3em; text-align:right">
 <span class="date" title="Sat Jun  7 02:13:28 2014">
 Jun 7, 2014
 </span>
 
 
 </div>
 
 
 
 
 
 
 
 
 
 
 <span class="author">
 
 <a name="c7" href="/p/goagent/issues/detail?id=14192#c7">#7</a>
 

 <a class="userlink"
 href="/u/116383151295439244875/">xiaoma8....@gmail.com</a
></span>
 
<pre>
googel代理（GoAgent)漏洞导致中间人攻击
Jun
05
2014
作者：backlion   发布：2014-06-05 21:54   分类：入侵渗透   阅读：33 views   抢沙发  
GoAgent 导入公开私钥的根证书的问题
· 测试页面
· 如何防范风险
· 如何删除 GoAgent CA 证书
GoAgent 没有进行正确的 TLS 验证，存在中间人攻击的风险
· 如何防范风险
    GoAgent (<a href="https://github.com/goagent/goagent" rel="nofollow">https://github.com/goagent/goagent</a>) 利用 Google App Engine(GAE) 来代理上网的一个工具，深受网民的欢迎。但是，GoAgent 的安装和配置中存在两点严重安全风险的问题却鲜为人知。这两点安全风险都可能被攻击者利用进行 “中间人攻击（man-in-the-middle attack）” 来窃取 GoAgent 用户的网络帐号密码等敏感信息，其概括描述如下：
   -   GoAgent 在启动时会尝试自动往系统的可信根证书中导入一个名为 “GoAgentCA” 的证书。由于这个证书的私钥是公开的，导致任何人都可以利用这个私钥来伪造任意网站的证书，进行 HTTPS 中间人攻击。即使在不开启 GoAgent 时，这种攻击的风险仍然存在。换而言之，一旦这个证书被导入，攻击者可以用此绕过几乎所有网站的 HTTPS 保护。
   -  GoAgent 本身对 TLS 证书的认证存在问题，而且默认时不对证书进行检查，这导致在使用 GoAgent 时存在 HTTPS 中间人攻击的风险。
    事实上曾经有用户在 GoAgent 主页上的问题跟踪列表中指出了这两个安全问题（见以下链接），但既没有修复也没有广泛公开，多数用户，尤其是非中文用户可能并不知情。下面是这两个问题的详细解释。
   -   <a href="https://code.google.com/p/goagent/issues/detail?id=11091" rel="nofollow">https://code.google.com/p/goagent/issues/detail?id=11091</a>
   -   <a href="https://code.google.com/p/goagent/issues/detail?id=8031" rel="nofollow">https://code.google.com/p/goagent/issues/detail?id=8031</a>
GoAgent 导入公开私钥根证书的问题 
    GoAgent 在启动时会尝试在系统中导入一个根证书来避免访问 HTTPS 网站时的证书报警，但在默认情况下所导入证书的私钥是公开的。因为私钥公开，任何人可以作为 “GoAgent CA” 来签发任何网站的证书。即使在 GoAgent 没有启动甚至卸载的情况下，这个公钥仍会遗留在系统中。在有些系统中，GoAgent 所导入的根证书不仅被 GoAgent 默认使用的浏览器信任，其他的浏览器也可能会信任这一根证书，从而受到这一问题的影响。
    GoAgent 所导入的这一公开私钥根证书的指纹是：
SHA1 Fingerprint=AB:70:2C:DF:18:EB:E8:B4:38:C5:28:69:CD:4A:5D:EF:48:B4:0E:33
MD5 Fingerprint=56:B1:20:86:1B:0A:B0:61:38:00:1B:C3:67:CF:0C:CC
    包含这一 “GoAgent CA” 证书以其私钥（文件中 “—–BEGIN RSA PRIVATE KEY—–” 位置）的文件 URL 为：
    <a href="https://github.com/goagent/goagent/blob/c4386808ea943e2ebed25f1e5264943354e3f9cb/local/CA.crt" rel="nofollow">https://github.com/goagent/goagent/blob/c4386808ea943e2ebed25f1e5264943354e3f9cb/local/CA.crt</a>
    根据版本信息，这一证书和私钥从 2011 年 6 月甚至更早的时间以来一直保持不变。
    <a href="https://github.com/goagent/goagent/blob/fa9959e577395e48a477fd5495afbc2363a51baa/local/CA.key" rel="nofollow">https://github.com/goagent/goagent/blob/fa9959e577395e48a477fd5495afbc2363a51baa/local/CA.key</a>
    GoAgent 主要包含两个部分：一个在用户计算机上运行的本地代理程序proxy.py，以及一个在 GAE 上运行的远程代理程序 gae.py。
    <a href="https://github.com/goagent/goagent/blob/c4386808ea943e2ebed25f1e5264943354e3f9cb/local/proxy.py" rel="nofollow">https://github.com/goagent/goagent/blob/c4386808ea943e2ebed25f1e5264943354e3f9cb/local/proxy.py</a>
    <a href="https://github.com/goagent/goagent/blob/c4386808ea943e2ebed25f1e5264943354e3f9cb/server/gae/gae.py" rel="nofollow">https://github.com/goagent/goagent/blob/c4386808ea943e2ebed25f1e5264943354e3f9cb/server/gae/gae.py</a>
    安装时，用户需要上传 gae.py 到 GAE。用户浏览器通过设置一个本地代理将HTTP/HTTPS 请求转发到 proxy.py，再由 proxy.py 和 gae.py 进行通信。
默认情况下，GoAgent 在启动时试图导入上述 GoAgent CA 证书。具体的代码为proxy.py 中的 CertUtil.import_ca：
<a href="https://github.com/goagent/goagent/blob/c4386808ea943e2ebed25f1e5264943354e3f9cb/local/proxy.py#L337" rel="nofollow">https://github.com/goagent/goagent/blob/c4386808ea943e2ebed25f1e5264943354e3f9cb/local/proxy.py#L337</a>
这个函数会根据用户操作系统通过不同的方式尝试导入证书，在某些情况下会需要
管理员（root/administrator）权限。在 Windows 下，这个函数会调用CertAddEncodedCertificateToStore 这一 API。在 OS X 下，会尝试执行系统命令
security find-certificate -a -c &quot;GoAgent&quot; | grep &quot;GoAgent&quot; &gt;/dev/null || security add-trusted-cert -d -r trustRoot -k &quot;/Library/Keychains/System.keychain&quot; &quot;&lt;pwd&gt;/CA.crt&quot;
    在 Ubuntu 下，会拷贝证书文件到 /usr/local/share/ca-certificates 然后执行 update-ca-certificates。在其他 GNU/Linux 发行版中，会尝试执行以下命令更改 NSS 数据库：
certutil -L -d sql:$HOME/.pki/nssdb | grep &quot;GoAgent&quot; || certutil -d sql:$HOME/.pki/nssdb -A -t &quot;C,,&quot; -n &quot;GoAgent&quot; -i &quot;&lt;pwd&gt;/CA.crt&quot;
由于 Firefox 采用了不同的方式存储证书，这一自动安装过程不会导入 GoAgentCA 证书到 Firefox 中。但是 GoAgent 的安装指南和 FAQ 中说明了如何手动导入这一证书：
<a href="https://code.google.com/p/goagent/wiki/InstallGuide" rel="nofollow">https://code.google.com/p/goagent/wiki/InstallGuide</a> <a href="https://code.google.com/p/goagent/wiki/FAQ" rel="nofollow">https://code.google.com/p/goagent/wiki/FAQ</a> 。
这一证书随后被 proxy.py 用来作为 HTTPS 中间人来避免浏览器在访问 HTTPS网站时出现报警。GoAgent 的工作原理如下：首先 proxy.py 将浏览器的 HTTP请求进行编码并转发给 gae.py，gae.py 完成收到的请求然后将结果进行编码后返回给 proxy.py，最后 proxy.py 将结果转发给浏览器来完成 “翻墙” 过程。由于 GAE 的限制 （免费 app 无法使用 socket 接口），对于 HTTPS 请求，proxy.py 无法进行透明转发，只能作为中间人先和浏览器完成连接，然后获得其中的明文请求以后在转发给 gae.py。当收到 CONNECT 请求（这意味着浏览器正在浏览一个 HTTPS 网站）， proxy.py 首先利用 GoAgent CA 签发一个假的证书来和浏览器完成握手，从用户的角度，所有的 HTTPS 网站的证书都是由事先导入的 “GoAgent CA” 认证的，所以不会报警。有些浏览器会对少数网站的证书进行特别的检查（Certificate Pinning），这种情况下 “GoAgent CA” 所签发的证书可能会触发证书不安全的报警。GoAgent 的这种工作方式导致 HTTPS 不再是浏览器到网站的端到端安全通信，而变成了proxy.py 到 GAE，以及 GAE到网站两段独立的 HTTPS 连接，GAE 能够看到请求和应答的明文。
测试页面
    请访问 <a href="https://goagent-cert-test.bamsoftware.com/" rel="nofollow">https://goagent-cert-test.bamsoftware.com/</a> 来进行测试。这个页面使用了一个由 GoAgent CA 签发的证书。如果你的浏览器没有受到影响，会显示报警信息；如果没有看到报警，则表明你的浏览器导入了公开的 GoAgent CA 证书，存在严重安全风险。
如何防范风险
    GoAgent 本身带有生成证书文件 CA.crt 的功能。只需要删除 local/CA.crt 文件就能保证 GoAgent 所导入的证书是唯一的，不会被网络上的攻击者利用来进行攻击。
    下面的 “补丁（patch）” 文件会帮助你从 GoAgent 的 git 仓库中删除 CA.crt文件，请下载补丁文件并执行以下命令：
git am 0001-Remove-static-CA.crt.patch.
    如果你不是通过 git 获得GoAgent（例如直接从 <a href="https://code.google.com/p/goagent/" rel="nofollow">https://code.google.com/p/goagent/</a> 上的链接下载得到），请手动删除 local/CA.crt 文件。 <a href="https://www.bamsoftware.com/sec/0001-Remove-static-CA.crt.patch" rel="nofollow">https://www.bamsoftware.com/sec/0001-Remove-static-CA.crt.patch</a> 如果你以前曾经使用过 GoAgent，务必要检查系统中任何可能的地方，删除 SHA-1指纹为
AB:70:2C:DF:18:EB:E8:B4:38:C5:28:69:CD:4A:5D:EF:48:B4:0E:33
的“GoAgent CA” 证书（建议使用浏览器访问上面的测试页面进行检查）。下面说明在常见系统中检查和删除 GoAgent CA 证书的方法。
如何删除 GoAgent CA 证书
    Firefox 中，打开 “preferences”，”Advanced”, “Certificates”, “View Certificates”, “Authorities”，然后在证书列表中找到 “GoAgent CA”，选中并点击 “Delete or Distrust…” 按钮，然后确认。
    Ubuntu 下，删除 /usr/local/share/ca-certificates/GoAgent.crt 然后执行
update-ca-certificates --fresh
    Windows 下，请参考以下链接：
    <a href="http://technet.microsoft.com/enus/library/cc754841.aspx#BKMK_addlocal" rel="nofollow">http://technet.microsoft.com/enus/library/cc754841.aspx#BKMK_addlocal</a>
中”Adding certificates to the Trusted Root Certification Authorities store for a local computer” 的步骤，但是在 step 8 时右键选中 “GoAgent CA” 然后选择 “Delete”。
    在 Mac OS X下，打开 “Keychain Access” 应用，点击锁图标并输入密码解锁。在边上的控制面板中，选择 “System” 以及 “Certificates”，选中 “GoAgent CA” 然后按 “Delete” 键，点击 “Delete” 按钮并输入你的密码确认。
GoAgent 没有进行正确的 TLS 验证，存在中间人攻击的风险
    默认情况下，GoAgent 会通过 HTTPS 来保护本地 proxy.py 和 GAE 服务器上的 gae.py 之间的通信 （在配置文件 proxy.ini 中相关的设置默认为gae.mode=https）。但是同样在默认情况下，GoAgent 不会要求对 GAE 服务器的证书进行验证（gae.validate=0），这导致本地 proxy.py 和 App Engine服务器之间的通信存在 HTTPS 中间人攻击的风险。此外， gae.validate 配置项同样控制 App Engine 上的 gae.py 是否对网站服务器的证书进行验证，默认配置下这一配置为 0 导致 gae.py 也不会对网站证书进行验证，使得 gae.py和网站之间的通信同样存在 HTTPS 中间人攻击的风险。
    即使修改配置启用证书验证（gae.validate=1），GoAgent 对 App Engine 服务器证书的验证也并不严格：在 proxypy 中只是对证书的 organizationName 进行了粗略的检查（是否为 “Google ” 开头），而没有对主机名（hostname）进行匹配。<a href="https://github.com/goagent/goagent/blob/c4386808ea943e2ebed25f1e5264943354e3f9cb/local/proxy.py#L1623" rel="nofollow">https://github.com/goagent/goagent/blob/c4386808ea943e2ebed25f1e5264943354e3f9cb/local/proxy.py#L1623</a>
将配置改为 gae.validate=1 同时会启用 gae.py 段对网站服务器证书的验证，这部分的事先没有明显的问题。
<a href="https://github.com/goagent/goagent/blob/c4386808ea943e2ebed25f1e5264943354e3f9cb/server/gae/gae.py#L184" rel="nofollow">https://github.com/goagent/goagent/blob/c4386808ea943e2ebed25f1e5264943354e3f9cb/server/gae/gae.py#L184</a>
GoAgent 还提供了一个可选功能，通过 RC4 和一个共享密钥来对 proxy.py 和gae.py 之间的数据进行进一步的混淆。启用这一功能需要在 proxy.ini 中设置gae.password，以及 gae.options=rc4，并在 gae.py 中设置__password__ 变量。<a href="https://github.com/goagent/goagent/blob/c4386808ea943e2ebed25f1e5264943354e3f9cb/server/gae/gae.py#L5" rel="nofollow">https://github.com/goagent/goagent/blob/c4386808ea943e2ebed25f1e5264943354e3f9cb/server/gae/gae.py#L5</a>
    但是，这里的 RC4 加密只能起到一个简单的混淆作用，无法在不启用 HTTPS 的情况下利用这一功能来防止中间人攻击。GoAgent 中的 RC4 无法实现数据的机密性，因为密码本身会通过一个 G-password 头在 proxy.py 和 gae.py 中传送，而且在两段通信中会使用同样的密码流（keystream），导致攻击者很容易通过密文的 XOR操作来获得 XOR 过的明文（见流密码的重用问题，Stream Cipher Key Reuse），进而得到明文。在这里 RC4 只能起到防止其他 GoAgent 用户共享服务端流量的目的，无法提供更多的保护来防止网络攻击。
如何防范风险
    确认在 proxy.ini 中设置了 gae.mode=https （默认），并且启用了证书验证 gae.validate=1（非默认）。这样的设定基本上能够防止 proxy.py 和GAE 服务器，以及 GAE 服务器和网站服务器之间的 HTTPS 中间人攻击。由于proxy.py 中没有对证书的主机名进行严格匹配，proxy.py 和 GAE 服务器 的通信仍存在（相对较小的）风险，如果有人能够申请到 organizationName 字段以“Google ” 开头的证书，仍然能够成功进行HTTPS 中间人攻击。
参考原文： <a href="http://seclists.org/fulldisclosure/2014/Jun/9" rel="nofollow">http://seclists.org/fulldisclosure/2014/Jun/9</a>
</pre>
 
 
 </div>
 

 
 
 
 
 <div class="cursor_off vt issuecomment"
 id="hc8">
 <div style="float:right; margin-right:.3em; text-align:right">
 <span class="date" title="Sat Jun  7 02:14:03 2014">
 Jun 7, 2014
 </span>
 
 
 </div>
 
 
 
 
 
 
 
 
 
 
 <span class="author">
 
 <a name="c8" href="/p/goagent/issues/detail?id=14192#c8">#8</a>
 

 <a class="userlink"
 href="/u/116383151295439244875/">xiaoma8....@gmail.com</a
></span>
 
<pre>
原文： 

GoAgent vulnerabilities: CA cert with known private key,	TLS MITM
From: David Fifield &lt;david () bamsoftware com&gt;
Date: Mon, 2 Jun 2014 13:13:56 -0700
There is an HTML version of this document with screenshots at
<a href="https://www.bamsoftware.com/sec/goagent-advisory.html" rel="nofollow">https://www.bamsoftware.com/sec/goagent-advisory.html</a>.

  * GoAgent installs a root CA certificate with a known private key
      * Test page
      * Mitigation
      * How to remove the GoAgent certificate
  * Improper TLS validation makes GoAgent susceptible to
    man-in-the-middle attacks
      * Mitigation

  * GoAgent 导入公开私钥根证书的问题
      * 测试页面
      * 如何防止风险
      * 如何删除 GoAgent CA 证书
  * GoAgent 没有进行正确的 TLS 验证，存在中间人攻击的风险
      * 如何防止风险

GoAgent (<a href="https://github.com/goagent/goagent" rel="nofollow">https://github.com/goagent/goagent</a>) is a popular censorship
circumvention tool that uses Google App Engine as a proxy to bypass
China's Great Firewall. GoAgent has serious security flaws that put its
users at risk of man-in-the-middle attacks.

  * At startup, GoAgent installs trusted root &quot;GoAgent CA&quot; certificate
    whose private key is publicly known. With this private key, anyone
    may impersonate a certificate authority to attack GoAgent users. The
    risk of this flaw exists even when not using GoAgent, if GoAgent has
    been used any time in the past.
  * Improper TLS validation, and a lack of validation by default, mean
    that the HTTPS tunnel used by GoAgent can be subverted by an active
    attacker.

These flaws have been previously identified on GoAgent's issue tracker,
but are not yet widely disclosed, especially among the non-Chinese
community.

    <a href="https://code.google.com/p/goagent/issues/detail?id=11091" rel="nofollow">https://code.google.com/p/goagent/issues/detail?id=11091</a>
    
<a href="http://translate.google.com/translate?hl=en&amp;ie=UTF8&amp;sl=zh-CN&amp;tl=en&amp;u=http://code.google.com/p/goagent/issues/detail%3Fid%3D11091" rel="nofollow">http://translate.google.com/translate?hl=en&amp;ie=UTF8&amp;sl=zh-CN&amp;tl=en&amp;u=http://code.google.com/p/goagent/issues/detail%3Fid%3D11091</a>

    <a href="https://code.google.com/p/goagent/issues/detail?id=8031" rel="nofollow">https://code.google.com/p/goagent/issues/detail?id=8031</a>
    
<a href="http://translate.google.com/translate?hl=en&amp;ie=UTF8&amp;sl=zh-CN&amp;tl=en&amp;u=http://code.google.com/p/goagent/issues/detail%3Fid%3D8031" rel="nofollow">http://translate.google.com/translate?hl=en&amp;ie=UTF8&amp;sl=zh-CN&amp;tl=en&amp;u=http://code.google.com/p/goagent/issues/detail%3Fid%3D8031</a>


== GoAgent installs a root CA certificate with a known private key ==

At startup, GoAgent installs a system-wide root CA certificate with a
fixed and publicly known private key. Because the private key is known,
anyone can impersonate the &quot;GoAgent CA&quot; and sign certificates for almost
any web site. The trusted root CA certificate remains installed even
after GoAgent is turned off or removed. Depending on the circumstances
of GoAgent's installation, the certificate may also affect browsers
other than the one used with GoAgent, and other users of the same
computer.

The root CA certificate that GoAgent installs has the fingerprints:

    SHA1 Fingerprint=AB:70:2C:DF:18:EB:E8:B4:38:C5:28:69:CD:4A:5D:EF:48:B4:0E:33
    MD5 Fingerprint=56:B1:20:86:1B:0A:B0:61:38:00:1B:C3:67:CF:0C:CC

The file with &quot;-----BEGIN RSA PRIVATE KEY-----&quot; may be downloaded at
this URL, along with the certificate for &quot;GoAgent CA&quot;:

    <a href="https://github.com/goagent/goagent/blob/c4386808ea943e2ebed25f1e5264943354e3f9cb/local/CA.crt" rel="nofollow">https://github.com/goagent/goagent/blob/c4386808ea943e2ebed25f1e5264943354e3f9cb/local/CA.crt</a>

According to the version history, the key has been the same since June
2011 or earlier:

    <a href="https://github.com/goagent/goagent/blob/fa9959e577395e48a477fd5495afbc2363a51baa/local/CA.key" rel="nofollow">https://github.com/goagent/goagent/blob/fa9959e577395e48a477fd5495afbc2363a51baa/local/CA.key</a>

GoAgent has two parts: a local proxy program, proxy.py, that runs on a
user's computer, and a remote proxy program, gae.py, that runs on App
Engine.

    <a href="https://github.com/goagent/goagent/blob/c4386808ea943e2ebed25f1e5264943354e3f9cb/local/proxy.py" rel="nofollow">https://github.com/goagent/goagent/blob/c4386808ea943e2ebed25f1e5264943354e3f9cb/local/proxy.py</a>
    <a href="https://github.com/goagent/goagent/blob/c4386808ea943e2ebed25f1e5264943354e3f9cb/server/gae/gae.py" rel="nofollow">https://github.com/goagent/goagent/blob/c4386808ea943e2ebed25f1e5264943354e3f9cb/server/gae/gae.py</a>

Users upload a personal copy of gae.py to App Engine. The user's browser
talks to proxy.py on localhost, and proxy.py talks to gae.py on App
Engine.

When run, GoAgent attempts to install the GoAgent CA certificate. The
responsible function is CertUtil.import_ca:

    <a href="https://github.com/goagent/goagent/blob/c4386808ea943e2ebed25f1e5264943354e3f9cb/local/proxy.py#L337" rel="nofollow">https://github.com/goagent/goagent/blob/c4386808ea943e2ebed25f1e5264943354e3f9cb/local/proxy.py#L337</a>

The installation code is different for different operating systems, and
varies as to what browsers and users it affects. In some cases it
requires administrator privileges. On Windows, it calls the
CertAddEncodedCertificateToStore function. On OS X, it runs the command

    security find-certificate -a -c &quot;GoAgent&quot; | grep &quot;GoAgent&quot; &gt;/dev/null || security add-trusted-cert -d -r trustRoot 
-k &quot;/Library/Keychains/System.keychain&quot; &quot;&lt;pwd&gt;/CA.crt&quot;

On Ubuntu, it copies the certificate file to
/usr/local/share/ca-certificates and calls update-ca-certificates. On
other varieties of GNU/Linux, it attempts to modify the NSS database
with the command

    certutil -L -d sql:$HOME/.pki/nssdb | grep &quot;GoAgent&quot; || certutil -d sql:$HOME/.pki/nssdb -A -t &quot;C,,&quot; -n &quot;GoAgent&quot; 
-i &quot;&lt;pwd&gt;/CA.crt&quot;

The automatic installation is ineffective for Firefox, which has its own
certificate store. GoAgent's installation guide and FAQ show how to
import the certificate into Firefox manually.

    <a href="https://code.google.com/p/goagent/wiki/InstallGuide" rel="nofollow">https://code.google.com/p/goagent/wiki/InstallGuide</a>
    
<a href="http://translate.google.com/translate?hl=en&amp;ie=UTF8&amp;sl=zh-CN&amp;tl=en&amp;u=http://code.google.com/p/goagent/wiki/InstallGuide" rel="nofollow">http://translate.google.com/translate?hl=en&amp;ie=UTF8&amp;sl=zh-CN&amp;tl=en&amp;u=http://code.google.com/p/goagent/wiki/InstallGuide</a>

    <a href="https://code.google.com/p/goagent/wiki/FAQ" rel="nofollow">https://code.google.com/p/goagent/wiki/FAQ</a>
    <a href="http://translate.google.com/translate?hl=en&amp;ie=UTF8&amp;sl=zh-CN&amp;tl=en&amp;u=http://code.google.com/p/goagent/wiki/FAQ" rel="nofollow">http://translate.google.com/translate?hl=en&amp;ie=UTF8&amp;sl=zh-CN&amp;tl=en&amp;u=http://code.google.com/p/goagent/wiki/FAQ</a>

The GoAgent CA certificate is used to do a local (intentional)
man-in-the-middle of HTTPS connections between the browser and proxy.py.
GoAgent works by encoding HTTP requests received by proxy.py and sending
them to gae.py, where gae.py makes the encoded request. gae.py then
encodes the HTTP response and sends it back to proxy.py, where it is
decoded and returned to the browser. In order for GoAgent to work with
HTTPS sites, it needs to undo the encryption so that gae.py will know
what URL to request. When proxy.py receives a CONNECT request (meaning
an HTTPS site is requested), it generates and serves a fake certificate
signed by the GoAgent CA. From the user's point of view, all HTTPS sites
are verified by &quot;GoAgent&quot;. In some browsers, certificate pinning
prevents the GoAgent technique from working for a small number of sites.
(A consequence of GoAgent's model is that HTTPS is not end-to-end. It is
HTTPS between the user and App Engine, and HTTPS between App Engine and
the web site, but App Engine gets to see the plaintext.)


=== Test page ===

To test whether you are affected by the GoAgent CA vulnerability, access
this web page:

    <a href="https://goagent-cert-test.bamsoftware.com/" rel="nofollow">https://goagent-cert-test.bamsoftware.com/</a> 

The web page uses a certificate signed by the GoAgent CA. If you are not
vulnerable, your browser will display a certificate warning. If you are
vulnerable, the web page will be shown with no warning.


=== Mitigation ===

GoAgent has the ability to regenerate CA.crt with a new, truly private
key. Delete the file local/CA.crt and start GoAgent again. The new
certificate and private key will be unique to your installation, and
only those with access to your computer will be able to attack your
HTTPS sessions.

This patch file removes the CA.crt file from a GoAgent Git repository.
Apply it with the command &quot;git am 0001-Remove-static-CA.crt.patch&quot;. If
you have a copy of the code that is not a Git repository, delete the
file local/CA.crt manually.

    <a href="https://www.bamsoftware.com/sec/0001-Remove-static-CA.crt.patch" rel="nofollow">https://www.bamsoftware.com/sec/0001-Remove-static-CA.crt.patch</a>

If you have ever run GoAgent in the past, it is important to also remove
the &quot;GoAgent CA&quot; certificate with SHA-1 fingerprint
AB:70:2C:DF:18:EB:E8:B4:38:C5:28:69:CD:4A:5D:EF:48:B4:0E:33 from
anywhere it might be installed. See the next section for how to do that
on selected operating systems.


=== How to remove the GoAgent certificate ===

In Firefox, open the preferences, then go to Advanced, Certificates,
View Certificates, Authorities, and select &quot;GoAgent CA&quot; in the list.
Click the &quot;Delete or Distrust...&quot; button, then click OK.

On Ubuntu, delete the file /usr/local/share/ca-certificates/GoAgent.crt
and run the command

    update-ca-certificates --fresh

On Windows, refer to these instructions:

    <a href="http://technet.microsoft.com/en-us/library/cc754841.aspx#BKMK_addlocal" rel="nofollow">http://technet.microsoft.com/en-us/library/cc754841.aspx#BKMK_addlocal</a> 

Follow the instructions under &quot;Adding certificates to the Trusted Root
Certification Authorities store for a local computer&quot;, but at step 8,
right-click on &quot;GoAgent CA&quot; and select &quot;Delete&quot;.

A screenshot of the Windows Trusted Root Certification Authorities store
with &quot;GoAgent CA&quot; selected

On Mac OS X, open the application called Keychain Access. Click the lock
to unlock it and enter your password. In the side panel, select &quot;System&quot;
and &quot;Certificates&quot;. Highlight &quot;GoAgent CA&quot; and press the delete key on
the keyboard. Click the &quot;Delete&quot; button and enter your password again.


== Improper TLS validation makes GoAgent susceptible to man-in-the-middle attacks ==

By default, GoAgent establishes an HTTPS tunnel between the local
proxy.py and gae.py running on App Engine. (In the default proxy.ini
configuration file, the default setting is gae.mode=https.) However by
default, it does not validate the server's certificate (gae.validate=0),
making possible an HTTPS man-in-the-middle attack between GoAgent and
App Engine. Further, the gae.validate option also controls whether
validation is done between App Engine and the remote web server, so that
is disabled by default as well, enabling HTTPS man-in-the-middle between
App Engine and the destination web site.

Even when validation is enabled (gae.validate=1), the validation works
differently than usual: It does not match against the remote hostname,
but rather checks that the certificate's organizationName begins with
&quot;Google &quot;.

    <a href="https://github.com/goagent/goagent/blob/c4386808ea943e2ebed25f1e5264943354e3f9cb/local/proxy.py#L1623" rel="nofollow">https://github.com/goagent/goagent/blob/c4386808ea943e2ebed25f1e5264943354e3f9cb/local/proxy.py#L1623</a>

Setting gae.validate=1 causes gae.py to validate its HTTP transactions.
Except that validation is not enabled by default, there doesn't appear
to be a problem with the validation in gae.py.

    <a href="https://github.com/goagent/goagent/blob/c4386808ea943e2ebed25f1e5264943354e3f9cb/server/gae/gae.py#L184" rel="nofollow">https://github.com/goagent/goagent/blob/c4386808ea943e2ebed25f1e5264943354e3f9cb/server/gae/gae.py#L184</a>

GoAgent optionally obfuscates its encoded HTTP requests and responses by
encrypting them with RC4 and a password-derived key. The obfuscation
option is enabled by setting gae.password and gae.options=rc4 in the
proxy.ini configuration file, as well as the __password__ variable in
gae.py.

    <a href="https://github.com/goagent/goagent/blob/c4386808ea943e2ebed25f1e5264943354e3f9cb/server/gae/gae.py#L5" rel="nofollow">https://github.com/goagent/goagent/blob/c4386808ea943e2ebed25f1e5264943354e3f9cb/server/gae/gae.py#L5</a>

However, the RC4 encryption is intended only for obfuscation, and does
not mitigate a man-in-the-middle attack. It offers no confidentiality,
because the password is sent along with each ciphertext in a G-password
header. Also, the same keystream is reused for all messages in both
directions, making it possible to XOR ciphertexts and get the XOR of
plaintexts. The RC4 feature prevents other users from trivially using up
your App Engine bandwidth quota, but doesn't provide additional
protection against a network adversary.


=== Mitigation ===

In the proxy.ini configuration file, make sure to set gae.mode=https
(the default) and gae.validate=1 (not the default). These settings
enable validation both between GoAgent and App Engine, and between App
Engine and the remote web site. There remains a risk of
man-in-the-middle by someone able to get a valid certificate with
&quot;Google &quot; in the organizationName.


------------------------------------------------------------------------


GoAgent (<a href="https://github.com/goagent/goagent" rel="nofollow">https://github.com/goagent/goagent</a>) 利用 Google App Engine
(GAE) 来绕过 GFW 的封锁，以免费、快速、稳定的特点深受网民的欢迎。但
是，GoAgent 的安装和配置中存在两点严重安全风险的问题却鲜为人知。这两点安
全风险都可能被攻击者利用进行 “中间人攻击（man-in-the-middle attack）” 来
窃取 GoAgent 用户的网络帐号密码等敏感信息，其概括描述如下：

  * GoAgent 在启动时会尝试自动往系统的可信根证书中导入一个名为 “GoAgent
    CA” 的证书。由于这个证书的私钥是公开的，导致任何人都可以利用这个私钥
    来伪造任意网站的证书进行 HTTPS 中间人攻击。即使在不开启 GoAgent 时，
    这种攻击的风险仍然存在。换而言之，一旦这个证书被导入，攻击者可以用此
    绕过几乎所有网站的 HTTPS 保护。
  * GoAgent 本身对 TLS 证书的认证存在问题，而且默认时不对证书进行检查，
    这导致在使用 GoAgent 时存在 HTTPS 中间人攻击的风险。

事实上曾经有用户在 GoAgent 主页上的问题跟踪列表中指出了这两个安全问题
（见以下链接），但既没有修复也没有广泛公开，多数用户，尤其是非中文用户可
能并不知情。下面是这两个问题的详细解释。

    <a href="https://code.google.com/p/goagent/issues/detail?id=11091" rel="nofollow">https://code.google.com/p/goagent/issues/detail?id=11091</a>
    <a href="https://code.google.com/p/goagent/issues/detail?id=8031" rel="nofollow">https://code.google.com/p/goagent/issues/detail?id=8031</a> 

== GoAgent 导入公开私钥根证书的问题 ==

GoAgent 在启动时会尝试在系统中导入一个根证书来避免访问 HTTPS 网站时的证
书报警，但在默认情况下所导入证书的私钥是公开的。因为私钥公开，任何人可以
作为 “GoAgent CA” 来签发任何网站的证书。即使在 GoAgent 没有启动甚至卸载
的情况下，这个公钥仍会遗留在系统中。在有些系统中，GoAgent 所导入的根证书
不仅被 GoAgent 默认使用的浏览器信任，其他的浏览器也可能会信任这一根证
书，从而受到这一问题的影响。

GoAgent 所导入的这一公开私钥根证书的指纹是：

    SHA1 Fingerprint=AB:70:2C:DF:18:EB:E8:B4:38:C5:28:69:CD:4A:5D:EF:48:B4:0E:33
    MD5 Fingerprint=56:B1:20:86:1B:0A:B0:61:38:00:1B:C3:67:CF:0C:CC

包含这一 “GoAgent CA” 证书以其私钥（文件中 “-----BEGIN RSA PRIVATE
KEY-----” 位置）的文件 URL 为：

    <a href="https://github.com/goagent/goagent/blob/c4386808ea943e2ebed25f1e5264943354e3f9cb/local/CA.crt" rel="nofollow">https://github.com/goagent/goagent/blob/c4386808ea943e2ebed25f1e5264943354e3f9cb/local/CA.crt</a>

根据版本信息，这一证书和私钥从 2011 年 6 月甚至更早的时间以来一直保持不变。

    <a href="https://github.com/goagent/goagent/blob/fa9959e577395e48a477fd5495afbc2363a51baa/local/CA.key" rel="nofollow">https://github.com/goagent/goagent/blob/fa9959e577395e48a477fd5495afbc2363a51baa/local/CA.key</a>

GoAgent 主要包含两个部分：一个在用户计算机上运行的本地代理程序
proxy.py，以及一个在 GAE 上运行的远程代理程序 gae.py。

    <a href="https://github.com/goagent/goagent/blob/c4386808ea943e2ebed25f1e5264943354e3f9cb/local/proxy.py" rel="nofollow">https://github.com/goagent/goagent/blob/c4386808ea943e2ebed25f1e5264943354e3f9cb/local/proxy.py</a>
    <a href="https://github.com/goagent/goagent/blob/c4386808ea943e2ebed25f1e5264943354e3f9cb/server/gae/gae.py" rel="nofollow">https://github.com/goagent/goagent/blob/c4386808ea943e2ebed25f1e5264943354e3f9cb/server/gae/gae.py</a>

安装时，用户需要上传 gae.py 到 GAE。用户浏览器通过设置一个本地代理将
HTTP/HTTPS 请求转发到 proxy.py，再由 proxy.py 和 gae.py 进行通信。

默认情况下，GoAgent 在启动时试图导入上述 GoAgent CA 证书。具体的代码为
proxy.py 中的 CertUtil.import_ca：

    <a href="https://github.com/goagent/goagent/blob/c4386808ea943e2ebed25f1e5264943354e3f9cb/local/proxy.py#L337" rel="nofollow">https://github.com/goagent/goagent/blob/c4386808ea943e2ebed25f1e5264943354e3f9cb/local/proxy.py#L337</a>

这个函数会根据用户操作系统通过不同的方式尝试导入证书，在某些情况下会需要
管理员 （root/administrator）权限。在 Windows 下，这个函数会调用
CertAddEncodedCertificateToStore 这一 API。在 OS X 下，会尝试执行系统命令

    security find-certificate -a -c &quot;GoAgent&quot; | grep &quot;GoAgent&quot; &gt;/dev/null || security add-trusted-cert -d -r trustRoot 
-k &quot;/Library/Keychains/System.keychain&quot; &quot;&lt;pwd&gt;/CA.crt&quot;

在 Ubuntu 下，会拷贝证书文件到 /usr/local/share/ca-certificates 然后执
行 update-ca-certificates。在其他 GNU/Linux 发行版中，会尝试执行以下命
令更改 NSS 数据库：

    certutil -L -d sql:$HOME/.pki/nssdb | grep &quot;GoAgent&quot; || certutil -d sql:$HOME/.pki/nssdb -A -t &quot;C,,&quot; -n &quot;GoAgent&quot; 
-i &quot;&lt;pwd&gt;/CA.crt&quot;

由于 Firefox 采用了不同的方式存储证书，这一自动安装过程不会导入 GoAgent
CA 证书到 Firefox 中。但是 GoAgent 的安装指南和 FAQ 中说明了如何手动导入
这一证书：

    <a href="https://code.google.com/p/goagent/wiki/InstallGuide" rel="nofollow">https://code.google.com/p/goagent/wiki/InstallGuide</a>
    <a href="https://code.google.com/p/goagent/wiki/FAQ" rel="nofollow">https://code.google.com/p/goagent/wiki/FAQ</a> 

这一证书随后被 proxy.py 用来作为 HTTPS 中间人来避免浏览器在访问 HTTPS
网站时出现报警。GoAgent 的工作原理如下：首先 proxy.py 将浏览器的 HTTP
请求进行编码并转发给 gae.py，gae.py 完成收到的请求然后将结果进行编码
后返回给 proxy.py，最后 proxy.py 将结果转发给浏览器来完成 “翻墙” 过
程。由于 GAE 的限制 （免费 app 无法使用 socket 接口），对于 HTTPS 请
求，proxy.py 无法进行透明转发，只能作为中间人先和浏览器完成连接，然后
获得其中的明文请求以后在转发给 gae.py。当收到 CONNECT 请求（这意味着
浏览器正在浏览一个 HTTPS 网站）， proxy.py 首先利用 GoAgent CA 签发一
个假的证书来和浏览器完成握手，从用户的角度，所有的 HTTPS 网站的证书都是
由事先导入的 “GoAgent CA” 认证的，所以不会报警。有些浏览器会对少数网站的
证书进行特别的检查（Certificate Pinning），这种情况下 &quot;GoAgent CA” 所签
发的证书可能会触发证书不安全的报警。GoAgent 的这种工作方式导致 HTTPS 不
再是浏览器到网站的端到端安全通信，而变成了 proxy.py 到 GAE，以及 GAE
到网站两段独立的 HTTPS 连接，GAE 能够看到请求和应答的明文。


=== 测试页面===

请访问

    <a href="https://goagent-cert-test.bamsoftware.com/" rel="nofollow">https://goagent-cert-test.bamsoftware.com/</a> 

来进行测试。这个页面使用了一个由 GoAgent CA 签发的证书。如果你的浏览器没
有受到影响，会显示报警信息；如果没有看到报警，则表明你的浏览器导入了公开
的 GoAgent CA 证书，存在严重安全风险。


=== 如何防止风险 ===

GoAgent 本身带有生成证书文件 CA.crt 的功能。只需要删除 local/CA.crt 文件
就能保证 GoAgent 所导入的证书是唯一的，不会被网络上的攻击者利用来进行攻击。

下面的 “补丁（patch）” 文件会帮助你从 GoAgent 的 git 仓库中删除 CA.crt
文件，请下载补丁文件并执行以下命令：
git am 0001-Remove-static-CA.crt.patch. 如果你不是通过 git 获得
GoAgent（例如直接从 <a href="https://code.google.com/p/goagent/" rel="nofollow">https://code.google.com/p/goagent/</a> 上的链接下载得到）
，请手动删除 local/CA.crt 文件。

    <a href="https://www.bamsoftware.com/sec/0001-Remove-static-CA.crt.patch" rel="nofollow">https://www.bamsoftware.com/sec/0001-Remove-static-CA.crt.patch</a>

如果你以前曾经使用过 GoAgent，务必要检查系统中任何可能的地方，删除 SHA-1
指纹为 AB:70:2C:DF:18:EB:E8:B4:38:C5:28:69:CD:4A:5D:EF:48:B4:0E:33 的
“GoAgent CA” 证书（建议使用浏览器访问上面的测试页面进行检查）。下面说明
在常见系统中检查和删除 GoAgent CA 证书的方法。


=== 如何删除 GoAgent CA 证书 ===

Firefox 中，打开 “preferences”，”Advanced”, “Certificates”, “View
Certificates”, “Authorities”，然后在证书列表中找到 “GoAgent CA”，选中并
点击 “Delete or Distrust...” 按钮，然后确认。

Ubuntu 下，删除 /usr/local/share/ca-certificates/GoAgent.crt 然后执行

    update-ca-certificates --fresh

Windows 下，请参考以下链接：

    <a href="http://technet.microsoft.com/en-us/library/cc754841.aspx#BKMK_addlocal" rel="nofollow">http://technet.microsoft.com/en-us/library/cc754841.aspx#BKMK_addlocal</a> 

中 &quot;Adding certificates to the Trusted Root Certification Authorities
store for a local computer&quot; 的步骤，但是在 step 8 时右键选中 &quot;GoAgent
CA&quot; 然后选择 &quot;Delete&quot;。

在 Mac OS X下，打开 “Keychain Access” 应用，点击锁图标并输入密码解锁。在
边上的控制面板中，选择 &quot;System&quot; 以及 &quot;Certificates&quot;，选中 &quot;GoAgent CA&quot;
然后按 “Delete” 键，点击 &quot;Delete&quot; 按钮并输入你的密码确认。


== GoAgent 没有进行正确的 TLS 验证，存在中间人攻击的风险 ==

默认情况下，GoAgent 会通过 HTTPS 来保护本地 proxy.py 和 GAE 服务器上
的 gae.py 之间的通信 （在配置文件 proxy.ini 中相关的设置默认为
gae.mode=https）。但是同样在默认情况下，GoAgent 不会要求对 GAE 服务器
的证书进行验证（gae.validate=0），这导致本地 proxy.py 和 App Engine
服务器之间的通信存在 HTTPS 中间人攻击的风险。此外， gae.validate 配置
项同样控制 App Engine 上的 gae.py 是否对网站服务器的证书进行验证，默认
配置下这一配置为 0 导致 gae.py 也不会对网站证书进行验证，使得 gae.py
和网站之间的通信同样存在 HTTPS 中间人攻击的风险

即使修改配置启用证书验证（gae.validate=1），GoAgent 对 App Engine 服务
器证书的验证也并不严格：在 proxy.py 中只是对证书的 organizationName 进
行了粗略的检查（是否为 “Google ” 开头），而没有对主机名（hostname）进行
匹配。

    <a href="https://github.com/goagent/goagent/blob/c4386808ea943e2ebed25f1e5264943354e3f9cb/local/proxy.py#L1623" rel="nofollow">https://github.com/goagent/goagent/blob/c4386808ea943e2ebed25f1e5264943354e3f9cb/local/proxy.py#L1623</a>

将配置改为 gae.validate=1 同时会启用 gae.py 段对网站服务器证书的验
证，这部分的事先没有明显的问题。

    <a href="https://github.com/goagent/goagent/blob/c4386808ea943e2ebed25f1e5264943354e3f9cb/server/gae/gae.py#L184" rel="nofollow">https://github.com/goagent/goagent/blob/c4386808ea943e2ebed25f1e5264943354e3f9cb/server/gae/gae.py#L184</a>

GoAgent 还提供了一个可选功能，通过 RC4 和一个共享密钥来对 proxy.py 和
gae.py 之间的数据进行进一步的混淆。启用这一功能需要在 proxy.ini 中设置
gae.password，以及 gae.options=rc4，并在 gae.py 中设置
__password__ 变量。

    <a href="https://github.com/goagent/goagent/blob/c4386808ea943e2ebed25f1e5264943354e3f9cb/server/gae/gae.py#L5" rel="nofollow">https://github.com/goagent/goagent/blob/c4386808ea943e2ebed25f1e5264943354e3f9cb/server/gae/gae.py#L5</a>

但是，这里的 RC4 加密只能起到一个简单的混淆作用，无法在不启用 HTTPS 的情
况下利用这一功能来防止中间人攻击。GoAgent 中的 RC4 无法实现数据的机密
性，因为密码本身会通过一个 G-password 头在 proxy.py 和 gae.py 中传
送，而且在两段通信中会使用同样的密码流（keystream），导致攻击者很容易通
过密文的 XOR 操作来获得 XOR 过的明文（见流密码的重用问题，Stream Cipher
Key Reuse），进而得到明文。在这里 RC4 只能起到防止其他 GoAgent 用户共享
服务端流量的目的，无法提供更多的保护来防止网络攻击。

=== 如何防止风险 ===

确认在 proxy.ini 中设置了 gae.mode=https （默认），并且启用了证书验
证 gae.validate=1（非默认）。这样的设定基本上能够防止 proxy.py 和
GAE 服务器，以及 GAE 服务器和网站服务器之间的 HTTPS 中间人攻击。由于
proxy.py 中没有对证书的主机名进行严格匹配，proxy.py 和 GAE 服务器 的
通信仍存在（相对较小的）风险，如果有人能够申请到 organizationName 字段以
“Google ” 开头的证书，仍然能够成功进行HTTPS 中间人攻击。
</pre>
 
 
 </div>
 

 
 
 
 
 <div class="cursor_off vt issuecomment"
 id="hc9">
 <div style="float:right; margin-right:.3em; text-align:right">
 <span class="date" title="Sat Jun  7 02:26:48 2014">
 Jun 7, 2014
 </span>
 
 
 </div>
 
 
 
 
 
 
 
 
 
 
 <span class="author">
 
 <a name="c9" href="/p/goagent/issues/detail?id=14192#c9">#9</a>
 

 <a class="userlink"
 href="/u/109680885935223716084/">david.da...@gmail.com</a
></span>
 
<pre>
可不可以提请开发者设置这个功能，就是不论是否自带安全证书，只要程序运行就重新动态生成一个安全证书覆盖一次，是否可以防范这样的攻击？
</pre>
 
 
 </div>
 

 
 
 
 
 <div class="cursor_off vt issuecomment"
 id="hc10">
 <div style="float:right; margin-right:.3em; text-align:right">
 <span class="date" title="Sat Jun  7 02:40:48 2014">
 Jun 7, 2014
 </span>
 
 
 </div>
 
 
 
 
 
 
 
 
 
 
 <span class="author">
 
 <a name="c10" href="/p/goagent/issues/detail?id=14192#c10">#10</a>
 

 <a class="userlink"
 href="/u/107383702792451430105/">mang...@gmail.com</a
></span>
 
<pre>
安全很重要。。。。不知道开发者关注这个问题了么？
</pre>
 
 
 </div>
 

 
 
 
 
 <div class="cursor_off vt issuecomment"
 id="hc11">
 <div style="float:right; margin-right:.3em; text-align:right">
 <span class="date" title="Sat Jun  7 04:10:07 2014">
 Jun 7, 2014
 </span>
 
 
 </div>
 
 
 
 
 
 
 
 
 
 
 <span class="author">
 
 <a name="c11" href="/p/goagent/issues/detail?id=14192#c11">#11</a>
 

 <a class="userlink"
 href="/u/107484212794511288084/">2007st...@gmail.com</a
></span>
 
<pre>
感谢 xiaoma8... 的善意提醒，但是这么长篇大论看的很头痛。请 xiaoma8... 总结归纳一下如下环境该如何操作？
系统：Windows 8.1 Pro
浏览器：IE 11、Google Chrome、Opera
</pre>
 
 
 </div>
 

 
 
 
 
 <div class="cursor_off vt issuecomment"
 id="hc12">
 <div style="float:right; margin-right:.3em; text-align:right">
 <span class="date" title="Sat Jun  7 06:25:31 2014">
 Jun 7, 2014
 </span>
 
 
 </div>
 
 
 
 
 
 
 
 
 
 
 <span class="author">
 
 <a name="c12" href="/p/goagent/issues/detail?id=14192#c12">#12</a>
 

 <a class="userlink"
 href="/u/113013826574677292201/">qtunnel....@gmail.com</a
></span>
 
<pre>
顶一下，这也是我非常担心的地方。
</pre>
 
 
 </div>
 

 
 
 
 
 <div class="cursor_off vt issuecomment"
 id="hc13">
 <div style="float:right; margin-right:.3em; text-align:right">
 <span class="date" title="Sat Jun  7 08:14:52 2014">
 Jun 7, 2014
 </span>
 
 
 </div>
 
 
 
 
 
 
 
 
 
 
 <span class="author">
 
 <a name="c13" href="/p/goagent/issues/detail?id=14192#c13">#13</a>
 

 <a class="userlink"
 href="/u/112745282911567235506/">happys...@gmail.com</a
></span>
 
<pre>
大家先按照文章最下面的设置操作一下，等作者的改进，相信这个小bug并不影响使用的。
</pre>
 
 
 </div>
 

 
 
 
 
 <div class="cursor_off vt issuecomment"
 id="hc14">
 <div style="float:right; margin-right:.3em; text-align:right">
 <span class="date" title="Sat Jun  7 10:34:05 2014">
 Jun 7, 2014
 </span>
 
 
 </div>
 
 
 
 
 
 
 
 
 
 
 <span class="author">
 
 <a name="c14" href="/p/goagent/issues/detail?id=14192#c14">#14</a>
 

 <a class="userlink"
 href="/u/116383151295439244875/">xiaoma8....@gmail.com</a
></span>
 
<pre>
好吧，原文确实很长，具体做法就是：
1：如果使用的默认证书，请删除CA.crt、certs文件夹，并且请在cmd下输入certmgr.msc，并且选择受信任的根证书颁发机构，找到goagent的证书，删除之，然后重新运行goagent会生成一个唯一的证书并导入。
2：如果已经生成唯一的证书，请在更新goagent版本的时候保持CA.crt、certs文件夹不要被新版默认证书覆盖，也就是不要更新这两个东西。
3：每次更新都要编辑proxy.ini的[gae]片段，确保mode = https、validate = 1
</pre>
 
 
 </div>
 

 
 
 
 
 <div class="cursor_off vt issuecomment"
 id="hc15">
 <div style="float:right; margin-right:.3em; text-align:right">
 <span class="date" title="Sat Jun  7 16:45:47 2014">
 Jun 7, 2014
 </span>
 
 
 </div>
 
 
 
 
 
 
 
 
 
 
 <span class="author">
 
 <a name="c15" href="/p/goagent/issues/detail?id=14192#c15">#15</a>
 

 <a class="userlink"
 href="/u/107484212794511288084/">2007st...@gmail.com</a
></span>
 
<pre>
我进一步总结归纳一下，有错误欢迎指正！

● 如果使用 GoAgent 则需要采取如下措施保证安全：
1. 将 zip 解压缩后删除 Goagent\local 下的 CA.crt 和 cacert.pem 这两个文件
2. 在 cmd 下输入  certmgr.msc 调取证书管理器 - 受信任的根证书颁发机构 - 证书 - 在右侧列表中找到 GoAgent CA 并删除
3. 重新运行 GoAgent 来随机生成证书
4. 确认在 proxy.ini 中的设置为
[gae]
mode = https
validate = 1

另外请问xiaoma8....，你总结的第2条中，具体如何操作才能在更新goagent的时候保证不更新CA.crt？另外，你这里的certs文件夹是指将该文件夹中的所有证书文件都删除吗？希望你能彻底说明透彻点，别马马虎虎。
</pre>
 
 
 </div>
 

 
 
 
 
 <div class="cursor_off vt issuecomment"
 id="hc16">
 <div style="float:right; margin-right:.3em; text-align:right">
 <span class="date" title="Sat Jun  7 16:53:01 2014">
 Jun 7, 2014
 </span>
 
 
 </div>
 
 
 
 
 
 
 
 
 
 
 <span class="author">
 
 <a name="c16" href="/p/goagent/issues/detail?id=14192#c16">#16</a>
 

 <a class="userlink"
 href="/u/107484212794511288084/">2007st...@gmail.com</a
></span>
 
<pre>
● 如果使用 GoAgent 则需要采取如下措施保证安全：

1. 将 zip 解压缩后删除 Goagent\local 下的 CA.crt 和 cacert.pem 这两个文件

2. 在 cmd 下输入  certmgr.msc 调取证书管理器 - 受信任的根证书颁发机构 - 证书 - 在右侧列表中找到 GoAgent CA 并删除

3. 确认 proxy.ini 中的设置为
[gae]
mode = https（默认）- 启用“超文本传输安全协议”
validate = 1（非默认）- 启用“证书验证”

4. 重新运行 GoAgent 来随机生成证书

5. 打算更新 GoAgent 的时候，先结束旧版本的进程并删除其文件夹，然后重复上述 1～4 步骤！
</pre>
 
 
 </div>
 

 
 
 
 
 <div class="cursor_off vt issuecomment"
 id="hc17">
 <div style="float:right; margin-right:.3em; text-align:right">
 <span class="date" title="Sat Jun  7 22:58:42 2014">
 Jun 7, 2014
 </span>
 
 
 </div>
 
 
 
 
 
 
 
 
 
 
 <span class="author">
 
 <a name="c17" href="/p/goagent/issues/detail?id=14192#c17">#17</a>
 

 <a class="userlink"
 href="/u/111417774546691146193/">fgo...@gmail.com</a
></span>
 
<pre>
作者怎么还不回应？
</pre>
 
 
 </div>
 

 
 
 
 
 <div class="cursor_off vt issuecomment"
 id="hc18">
 <div style="float:right; margin-right:.3em; text-align:right">
 <span class="date" title="Sun Jun  8 04:32:17 2014">
 Jun 8, 2014
 </span>
 
 
 </div>
 
 
 
 
 
 
 
 
 
 
 <span class="author">
 
 <a name="c18" href="/p/goagent/issues/detail?id=14192#c18">#18</a>
 

 <a class="userlink"
 href="/u/111417774546691146193/">fgo...@gmail.com</a
></span>
 
<pre>
无偿顶起


</pre>
 
 
 </div>
 

 
 
 
 
 <div class="cursor_off vt issuecomment"
 id="hc19">
 <div style="float:right; margin-right:.3em; text-align:right">
 <span class="date" title="Sun Jun  8 06:35:45 2014">
 Jun 8, 2014
 </span>
 
 
 </div>
 
 
 
 
 
 
 
 
 
 
 <span class="author">
 
 <a name="c19" href="/p/goagent/issues/detail?id=14192#c19">#19</a>
 

 <a class="userlink"
 href="/u/102254185601597991876/">qhwan...@gmail.com</a
></span>
 
<pre>
关注中，做个标记。
</pre>
 
 
 </div>
 

 
 
 
 
 <div class="cursor_off vt issuecomment"
 id="hc20">
 <div style="float:right; margin-right:.3em; text-align:right">
 <span class="date" title="Sun Jun  8 06:39:19 2014">
 Jun 8, 2014
 </span>
 
 
 </div>
 
 
 
 
 
 
 
 
 
 
 <span class="author">
 
 <a name="c20" href="/p/goagent/issues/detail?id=14192#c20">#20</a>
 

 <a class="userlink"
 href="/u/107383702792451430105/">mang...@gmail.com</a
></span>
 
<pre>
顶贴关注下，凡是关系到翻墙安全的都必须注意。虽然俺看小黄网为主。
</pre>
 
 
 </div>
 

 
 
 
 
 <div class="cursor_off vt issuecomment"
 id="hc21">
 <div style="float:right; margin-right:.3em; text-align:right">
 <span class="date" title="Sun Jun  8 11:22:31 2014">
 Jun 8, 2014
 </span>
 
 
 </div>
 
 
 
 
 
 
 
 
 
 
 <span class="author">
 
 <a name="c21" href="/p/goagent/issues/detail?id=14192#c21">#21</a>
 

 <a class="userlink"
 href="/u/106617263170138515646/">vest.apr...@gmail.com</a
></span>
 
<pre>
开启gae validate, 删除默认CA.crt, certs文件夹, 重新生成并导入后测试 [1]. Firefox/Chrome 会显示警告(可能需要清除浏览器缓存或用隐私模式浏览), 即告成功. 当然如David Fifield所说, 仍然还是存在中间人攻击的风险, 请谨慎使用GoAgent登录Gmail等重要帐号, 在导入GoAgent CA的机器上使用网银等.
烦请诸位多测试下.

[1] <a href="https://goagent-cert-test.bamsoftware.com/" rel="nofollow">https://goagent-cert-test.bamsoftware.com/</a>
</pre>
 
 
 </div>
 

 
 
 
 
 <div class="cursor_off vt issuecomment"
 id="hc22">
 <div style="float:right; margin-right:.3em; text-align:right">
 <span class="date" title="Sun Jun  8 12:28:03 2014">
 Jun 8, 2014
 </span>
 
 
 </div>
 
 
 
 
 
 
 
 
 
 
 <span class="author">
 
 <a name="c22" href="/p/goagent/issues/detail?id=14192#c22">#22</a>
 

 <a class="userlink"
 href="/u/116383151295439244875/">xiaoma8....@gmail.com</a
></span>
 
<pre>
因为已经在本地重新生成了根证书，所以就不需要更新的时候再把此证书删掉重新生成。因为已经不是默认的证书了。

然后更新的时候保持证书不被新版中提供的默认证书覆盖即可。

另外certs文件夹内是根证书针对你浏览的https网站颁发的本机证书，只要是你随机生成的根证书颁发的证书，certs文件夹的不需要在每次更新之后都删掉。
</pre>
 
 
 </div>
 

 
 
 
 
 <div class="cursor_off vt issuecomment"
 id="hc23">
 <div style="float:right; margin-right:.3em; text-align:right">
 <span class="date" title="Sun Jun  8 20:04:26 2014">
 Jun 8, 2014
 </span>
 
 
 </div>
 
 
 
 
 
 
 
 
 
 
 <span class="author">
 
 <a name="c23" href="/p/goagent/issues/detail?id=14192#c23">#23</a>
 

 <a class="userlink"
 href="/u/116744323084448200827/">SKE48Tea...@gmail.com</a
></span>
 
<pre>
firefox貌似要在浏览器里手动导入新生成的CA.crt
</pre>
 
 
 </div>
 

 
 
 
 
 <div class="cursor_off vt issuecomment"
 id="hc24">
 <div style="float:right; margin-right:.3em; text-align:right">
 <span class="date" title="Sun Jun  8 21:10:48 2014">
 Jun 8, 2014
 </span>
 
 
 </div>
 
 
 
 
 
 
 
 
 
 
 <span class="author">
 
 <a name="c24" href="/p/goagent/issues/detail?id=14192#c24">#24</a>
 

 <a class="userlink"
 href="/u/113550274966910333235/">she...@gmail.com</a
></span>
 
<pre>
firefox下重新导入证书还需要删掉cert8.db文件，具体位置可以用everything搜一下
</pre>
 
 
 </div>
 

 
 
 
 
 <div class="cursor_off vt issuecomment"
 id="hc25">
 <div style="float:right; margin-right:.3em; text-align:right">
 <span class="date" title="Sun Jun  8 22:57:05 2014">
 Jun 8, 2014
 </span>
 
 
 </div>
 
 
 
 
 
 
 
 
 
 
 <span class="author">
 
 <a name="c25" href="/p/goagent/issues/detail?id=14192#c25">#25</a>
 

 <a class="userlink"
 href="/u/107165811462177075222/">bikaiy...@gmail.com</a
></span>
 
<pre>
可是Firefox不导入证书就没法访问Facebook Twitter之类的网站，怎么破？
</pre>
 
 
 </div>
 

 
 
 
 
 <div class="cursor_off vt issuecomment"
 id="hc26">
 <div style="float:right; margin-right:.3em; text-align:right">
 <span class="date" title="Sun Jun  8 23:00:52 2014">
 Jun 8, 2014
 </span>
 
 
 </div>
 
 
 
 
 
 
 
 
 
 
 <span class="author">
 
 <a name="c26" href="/p/goagent/issues/detail?id=14192#c26">#26</a>
 

 <a class="userlink"
 href="/u/107165811462177075222/">bikaiy...@gmail.com</a
></span>
 
<pre>
哦哦，我已经弄好了，重新手动导入一下就可以了~ certs文件夹里自动生成了~
</pre>
 
 
 </div>
 

 
 
 
 
 <div class="cursor_off vt issuecomment"
 id="hc27">
 <div style="float:right; margin-right:.3em; text-align:right">
 <span class="date" title="Sun Jun  8 23:35:47 2014">
 Jun 8, 2014
 </span>
 
 
 </div>
 
 
 
 
 
 
 
 
 
 
 <span class="author">
 
 <a name="c27" href="/p/goagent/issues/detail?id=14192#c27">#27</a>
 

 <a class="userlink"
 href="/u/106457268381098693496/">cheming6...@gmail.com</a
></span>
 
<pre>
如果每次能够自动生成的话，为何作者不删除安装包中的cert文件？
</pre>
 
 
 </div>
 

 
 
 
 
 <div class="cursor_off vt issuecomment"
 id="hc28">
 <div style="float:right; margin-right:.3em; text-align:right">
 <span class="date" title="Sun Jun  8 23:37:49 2014">
 Jun 8, 2014
 </span>
 
 
 </div>
 
 
 
 
 
 
 
 
 
 
 <span class="author">
 
 <a name="c28" href="/p/goagent/issues/detail?id=14192#c28">#28</a>
 

 <a class="userlink"
 href="/u/111417774546691146193/">fgo...@gmail.com</a
></span>
 
<pre>
#27 
有阴毛
</pre>
 
 
 </div>
 

 
 
 
 
 <div class="cursor_off vt issuecomment"
 id="hc29">
 <div style="float:right; margin-right:.3em; text-align:right">
 <span class="date" title="Sun Jun  8 23:48:19 2014">
 Jun 8, 2014
 </span>
 
 
 </div>
 
 
 
 
 
 
 
 
 
 
 <span class="author">
 
 <a name="c29" href="/p/goagent/issues/detail?id=14192#c29">#29</a>
 

 <a class="userlink"
 href="/u/106457268381098693496/">cheming6...@gmail.com</a
></span>
 
<pre>
如果打开了RC4是不是能够安全一些？
</pre>
 
 
 </div>
 

 
 
 
 
 <div class="cursor_off vt issuecomment"
 id="hc30">
 <div style="float:right; margin-right:.3em; text-align:right">
 <span class="date" title="Sun Jun  8 23:53:29 2014">
 Jun 8, 2014
 </span>
 
 
 </div>
 
 
 
 
 
 
 
 
 
 
 <span class="author">
 
 <a name="c30" href="/p/goagent/issues/detail?id=14192#c30">#30</a>
 

 <a class="userlink"
 href="/u/106457268381098693496/">cheming6...@gmail.com</a
></span>
 
<pre>
该网站说：

   但是，这里的 RC4 加密只能起到一个简单的混淆作用，无法在不启用 HTTPS 的情况下利用这一功能来防止中间人攻击。GoAgent 中的 RC4 无法实现数据的机密性，因为密码本身会通过一个 G-password 头在 proxy.py 和 gae.py 中传送，而且在两段通信中会使用同样的密码流（keystream），导致攻击者很容易通过密文的 XOR操作来获得 XOR 过的明文（见流密码的重用问题，Stream Cipher Key Reuse），进而得到明文。在这里 RC4 只能起到防止其他 GoAgent 用户共享服务端流量的目的，无法提供更多的保护来防止网络攻击。

请作者澄清一下确实如此吗？
</pre>
 
 
 </div>
 

 
 
 
 
 <div class="cursor_off vt issuecomment"
 id="hc32">
 <div style="float:right; margin-right:.3em; text-align:right">
 <span class="date" title="Tue Jun 10 08:46:02 2014">
 Jun 10, 2014
 </span>
 
 
 </div>
 
 
 
 
 
 
 
 
 
 
 <span class="author">
 
 <a name="c32" href="/p/goagent/issues/detail?id=14192#c32">#32</a>
 

 <a class="userlink"
 href="/u/116383151295439244875/">xiaoma8....@gmail.com</a
></span>
 
<pre>
希望作者回应一下。。。各位点star谢谢
</pre>
 
 
 </div>
 

 
 
 
 
 <div class="cursor_off vt issuecomment"
 id="hc33">
 <div style="float:right; margin-right:.3em; text-align:right">
 <span class="date" title="Wed Jun 11 17:59:34 2014">
 Jun 11, 2014
 </span>
 
 
 </div>
 
 
 
 
 
 
 
 
 
 
 <span class="author">
 
 <a name="c33" href="/p/goagent/issues/detail?id=14192#c33">#33</a>
 

 <a class="userlink"
 href="/u/neil.yang.chn/">neil.yang.chn</a
></span>
 
<pre>
建议一定要开启Google 两步验证
<a href="https://www.google.com/intl/zh-CN/landing/2step/" rel="nofollow">https://www.google.com/intl/zh-CN/landing/2step/</a>
</pre>
 
 
 </div>
 

 
 
 
 
 <div class="cursor_off vt issuecomment"
 id="hc34">
 <div style="float:right; margin-right:.3em; text-align:right">
 <span class="date" title="Wed Jun 11 18:08:17 2014">
 Jun 11, 2014
 </span>
 
 
 </div>
 
 
 
 
 
 
 
 
 
 
 <span class="author">
 
 <a name="c34" href="/p/goagent/issues/detail?id=14192#c34">#34</a>
 

 <a class="userlink"
 href="/u/102282595204926484859/">Noah.i...@gmail.com</a
></span>
 
<pre>
请使用两部验证
</pre>
 
 
 </div>
 

 
 
 
 
 <div class="cursor_off vt issuecomment"
 id="hc35">
 <div style="float:right; margin-right:.3em; text-align:right">
 <span class="date" title="Thu Jun 12 07:57:10 2014">
 Jun 12, 2014
 </span>
 
 
 </div>
 
 
 
 
 
 
 
 
 
 
 <span class="author">
 
 <a name="c35" href="/p/goagent/issues/detail?id=14192#c35">#35</a>
 

 <a class="userlink"
 href="/u/101632663002601300137/">meiantu...@gmail.com</a
></span>
 
<pre>
这是gea的风险，不单只是goagent，所以gea代理只适合浏览，不适合发言，登录
</pre>
 
 
 </div>
 

 
 
 
 
 <div class="cursor_off vt issuecomment"
 id="hc37">
 <div style="float:right; margin-right:.3em; text-align:right">
 <span class="date" title="Wed Aug 20 09:57:50 2014">
 Aug 20, 2014
 </span>
 
 
 </div>
 
 
 
 
 
 
 
 
 
 
 <span class="author">
 
 <a name="c37" href="/p/goagent/issues/detail?id=14192#c37">#37</a>
 

 <a class="userlink"
 href="/u/115941899871341951311/">tonytan...@gmail.com</a
></span>
 
<pre>
希望作者尽快给予答复和修复。帐号安全是很重要的，如果有人用GoAgent上Google Wallet, PayPal 怎么办！？

I hope that the author responds to this issue soon. Security is of the utmost importance. What if someone uses Google Wallet / PayPal through GoAgent!?
</pre>
 
 
 </div>
 

 
 
 
 
 <div class="cursor_off vt issuecomment"
 id="hc38">
 <div style="float:right; margin-right:.3em; text-align:right">
 <span class="date" title="Wed Aug 20 18:29:40 2014">
 Aug 20, 2014
 </span>
 
 
 </div>
 
 
 
 
 
 
 
 
 
 
 <span class="author">
 
 <a name="c38" href="/p/goagent/issues/detail?id=14192#c38">#38</a>
 

 <a class="userlink"
 href="/u/103887503345730827402/">godtr...@gmail.com</a
></span>
 
<pre>
感谢楼主,读了#1,删除了CERT文件夹; 照#8中方法删除了CA证书.多谢了.
</pre>
 
 
 </div>
 

 
 
 
 
 <div class="cursor_off vt issuecomment"
 id="hc39">
 <div style="float:right; margin-right:.3em; text-align:right">
 <span class="date" title="Wed Aug 20 18:29:53 2014">
 Aug 20, 2014
 </span>
 
 
 </div>
 
 
 
 
 
 
 
 
 
 
 <span class="author">
 
 <a name="c39" href="/p/goagent/issues/detail?id=14192#c39">#39</a>
 

 <a class="userlink"
 href="/u/111156721086541343608/">yellow...@gmail.com</a
></span>
 
<pre>
免费工具总是有局限性的，如果有条件还是自己购买或搭建服务。RC4“加密”作者之前也有说过，只是为了防止自己的服务端被滥用，无法提供更多的保护来防止网络攻击。我觉得最重要的是，对普通goagent使用者来说，多一步操作都会多一分使用难度。以上只是自己的拙见，欢迎继续讨论。
</pre>
 
 
 </div>
 

 
 
 
 
 <div class="cursor_off vt issuecomment"
 id="hc40">
 <div style="float:right; margin-right:.3em; text-align:right">
 <span class="date" title="Thu Aug 21 09:04:59 2014">
 Aug 21, 2014
 </span>
 
 
 </div>
 
 
 
 
 
 
 
 
 
 
 <span class="author">
 
 <a name="c40" href="/p/goagent/issues/detail?id=14192#c40">#40</a>
 

 <a class="userlink"
 href="/u/115941899871341951311/">tonytan...@gmail.com</a
></span>
 
<pre>
楼上说的有一定道理，但是上述问题很多作者都可以解决，并不是不可能的（删除zip中的证书，在程序中加强对服务器SSL证书的验证并默认开启等）。当然感谢作者为大家做出了的贡献，但是如果作者不打算解决安全问题，应该在主页上对用户做出提醒。
</pre>
 
 
 </div>
 

 
 
 
 
 <div class="cursor_off vt issuecomment"
 id="hc41">
 <div style="float:right; margin-right:.3em; text-align:right">
 <span class="date" title="Thu Aug 21 09:39:07 2014">
 Aug 21, 2014
 </span>
 
 
 </div>
 
 
 
 
 
 
 
 
 
 
 <span class="author">
 
 <a name="c41" href="/p/goagent/issues/detail?id=14192#c41">#41</a>
 

 <a class="userlink"
 href="/u/115941899871341951311/">tonytan...@gmail.com</a
></span>
 
<pre>
还有，提醒大家，即便删除证书，并且设置Validate=1， 一样不能安全。

“即使修改配置启用证书验证（gae.validate=1），GoAgent 对 App Engine 服务器证书的验证也并不严格：在 proxypy 中只是对证书的 organizationName 进行了粗略的检查（是否为 “Google ” 开头），而没有对主机名（hostname）进行匹配。<a href="https://github.com/goagent/goagent/blob/c4386808ea943e2ebed25f1e5264943354e3f9cb/local/proxy.py#L1623" rel="nofollow">https://github.com/goagent/goagent/blob/c4386808ea943e2ebed25f1e5264943354e3f9cb/local/proxy.py#L1623</a> ”

源代码中的验证是这么写的（我用#加了些注释）：
                    cert = ssl_sock.getpeercert() #获取服务器证书
                    orgname = next((v for ((k, v),) in cert['subject'] if k == 'organizationName')) #获取Organization Name
                    if not orgname.lower().startswith('google '):  #如果Organization Name不是'Google'开始的
                        raise ssl.SSLError(&quot;%r certificate organizationName(%r) not startswith 'Google'&quot; % (hostname, orgname))  #验证错误，验证失败
                    #否则通过验证

就是说证书的OrganizationName只要是Google开头就行。攻击者大可以申请一个名叫“Google Is A Bad Company”的合法证书来蒙骗GoAgent，然后获取用户的各种网上的用户名密码(可以包括带有信用卡信息的账号，例如Google Wallet)。如果改一下，检查证书的域名是否为appspot.com结尾或者颁发者是否为“Google Internet Authority G2” 会更有效。

</pre>
 
 
 </div>
 

 
 
 
 
 <div class="cursor_off vt issuecomment"
 id="hc42">
 <div style="float:right; margin-right:.3em; text-align:right">
 <span class="date" title="Thu Aug 21 10:54:21 2014">
 Aug 21, 2014
 </span>
 
 
 </div>
 
 
 
 
 
 
 
 
 
 
 <span class="author">
 
 <a name="c42" href="/p/goagent/issues/detail?id=14192#c42">#42</a>
 

 <a class="userlink"
 href="/u/107163607800288251012/">snsdzhan...@gmail.com</a
></span>
 
<pre>
只是谷歌账户有风险吗
</pre>
 
 
 </div>
 

 
 
 
 
 <div class="cursor_off vt issuecomment"
 id="hc43">
 <div style="float:right; margin-right:.3em; text-align:right">
 <span class="date" title="Thu Aug 21 12:28:04 2014">
 Aug 21, 2014
 </span>
 
 
 </div>
 
 
 
 
 
 
 
 
 
 
 <span class="author">
 
 <a name="c43" href="/p/goagent/issues/detail?id=14192#c43">#43</a>
 

 <a class="userlink"
 href="/u/103116824335668625001/">chen.cz....@gmail.com</a
></span>
 
<pre>
驴唇不对马嘴，这个证书是（127.0.0.1）本机和你自己浏览器之间的ssl转换需要的证书，还研究来研究去的，自己搞明白再说吧，累劲的！
</pre>
 
 
 </div>
 

 
 
 
 
 <div class="cursor_off vt issuecomment"
 id="hc44">
 <div style="float:right; margin-right:.3em; text-align:right">
 <span class="date" title="Thu Aug 21 20:25:09 2014">
 Aug 21, 2014
 </span>
 
 
 </div>
 
 
 
 
 
 
 
 
 
 
 <span class="author">
 
 <a name="c44" href="/p/goagent/issues/detail?id=14192#c44">#44</a>
 

 <a class="userlink"
 href="/u/115941899871341951311/">tonytan...@gmail.com</a
></span>
 
<pre>
所有通过GoAgent登录的账户都有风险。

楼上说的不对。我们说的“证书”，其实分两个。一个是本机和浏览器之间的，还有一个是GAE服务器和本机之间的。其中，前者如果在初次使用时不删除造成的问题是任何人将来都可以在你不用GoAgent时冒充GoAgent劫持你的SSL连接。后者的问题是如果不被验证，服务器和本机之间的连接可以被截获。两者都是安全问题。都可以造成账号被盗。

所以建议楼上还是仔细读一下之前大家写的内容，搞懂技术原理，再去指责批评别人。

</pre>
 
 
 </div>
 

 
 
 
 
 <div class="cursor_off vt issuecomment"
 id="hc46">
 <div style="float:right; margin-right:.3em; text-align:right">
 <span class="date" title="Fri Aug 22 02:47:03 2014">
 Aug 22, 2014
 </span>
 
 
 </div>
 
 
 
 
 
 
 
 
 
 
 <span class="author">
 
 <a name="c46" href="/p/goagent/issues/detail?id=14192#c46">#46</a>
 

 <a class="userlink"
 href="/u/115941899871341951311/">tonytan...@gmail.com</a
></span>
 
<pre>
回应#45，解释一下，楼主的标题也是有道理的。确实是由于内置的cert证书所对应的私钥（Private Key）是公开的（<a href="https://github.com/goagent/goagent/blob/c4386808ea943e2ebed25f1e5264943354e3f9cb/local/CA.crt" rel="nofollow">https://github.com/goagent/goagent/blob/c4386808ea943e2ebed25f1e5264943354e3f9cb/local/CA.crt</a> ），造成了严重的安全隐患。如果将其删除，由程序重新随机生成一个新的证书，会消除该隐患。

“GoAgent 导入公开私钥根证书的问题 
    GoAgent 在启动时会尝试在系统中导入一个根证书来避免访问 HTTPS 网站时的证书报警，但在默认情况下所导入证书的私钥是公开的。因为私钥公开，任何人可以作为 “GoAgent CA” 来签发任何网站的证书。即使在 GoAgent 没有启动甚至卸载的情况下，这个公钥仍会遗留在系统中。在有些系统中，GoAgent 所导入的根证书不仅被 GoAgent 默认使用的浏览器信任，其他的浏览器也可能会信任这一根证书，从而受到这一问题的影响。
    GoAgent 所导入的这一公开私钥根证书的指纹是：
SHA1 Fingerprint=AB:70:2C:DF:18:EB:E8:B4:38:C5:28:69:CD:4A:5D:EF:48:B4:0E:33
MD5 Fingerprint=56:B1:20:86:1B:0A:B0:61:38:00:1B:C3:67:CF:0C:CC
    包含这一 “GoAgent CA” 证书以其私钥（文件中 “—–BEGIN RSA PRIVATE KEY—–” 位置）的文件 URL 为：
    <a href="https://github.com/goagent/goagent/blob/c4386808ea943e2ebed25f1e5264943354e3f9cb/local/CA.crt" rel="nofollow">https://github.com/goagent/goagent/blob/c4386808ea943e2ebed25f1e5264943354e3f9cb/local/CA.crt</a> ”


</pre>
 
 
 </div>
 

 
 
 
 
 <div class="cursor_off vt issuecomment"
 id="hc47">
 <div style="float:right; margin-right:.3em; text-align:right">
 <span class="date" title="Fri Aug 22 02:57:45 2014">
 Aug 22, 2014
 </span>
 
 
 </div>
 
 
 
 
 
 
 
 
 
 
 <span class="author">
 
 <a name="c47" href="/p/goagent/issues/detail?id=14192#c47">#47</a>
 

 <a class="userlink"
 href="/u/115941899871341951311/">tonytan...@gmail.com</a
></span>
 
<pre>
貌似#45被删掉了。我就不提是谁写的了，但是为了让其他人知道我在回复什么，我把#45的内容（以匿名的形式）再发一遍。希望#45的原作者理解，这并不是恶意的。

----------以下是#45楼被删除前的原文，不是我的意见----------
#44
楼主的标题是
“建议不要在下载的zip包中预留cert证书，我的google账号因此被盗”
这一句话里面有一个因果关系，&quot;因为作者内置了证书，所以导致楼主的帐号被盗”，用你的脚趾头想一下都知道，这个是肯定不成立的。作者内置的证书是原件，该内置的证书文件和作者本人一样值得信任。即使你删除这些证书，运行goagent时仍然会自动生成和这些证书完全相同的文件。所以，就算goagent有风险，这也和作者在压缩包内置证书文件没有任何关系。所以，所谓的“建议不要内置证书”也是个非常明显的假命题。

所以，
1.楼主这个标题纯粹就是用一个完全不成立的因果关系得出一个荒谬的所谓“建议”
2.楼主的内容和标题典型的文不对题，绝对的驴唇不对马嘴

所以，43楼指责楼主“驴唇不对马嘴”完全正确。
你呢，说的本身也许并没有错，但是和43楼说的完全不是一回事，你的正确并不能证明楼主的标题正确，也并不能证明楼主的文题相符，当然也更不能证明43楼说错了。

现在，我建议你批评别人之前仔细理解领会一下别人的意图。

----------以上是#45楼被删除前的原文，不是我的意见----------

</pre>
 
 
 </div>
 

 
 
 
 
 <div class="cursor_off vt issuecomment"
 id="hc49">
 <div style="float:right; margin-right:.3em; text-align:right">
 <span class="date" title="Fri Aug 22 05:30:01 2014">
 Aug 22, 2014
 </span>
 
 
 </div>
 
 
 
 
 
 
 
 
 
 
 <span class="author">
 
 <a name="c49" href="/p/goagent/issues/detail?id=14192#c49">#49</a>
 

 <a class="userlink"
 href="/u/104473434840565350915/">ssy0...@gmail.com</a
></span>
 
<pre>
#48
不对。如果goagent文件夹中没有证书，goagent运行时会自动随机生成一个新的完全不同的证书（MD5和SHA1都不一样），而且自动生成的证书文件大小（3.08K）都比zip包中预留的（2.887K）要大，每次自动生成的证书指纹也都不一样。看起来作者在设计上早就防范了默认证书的风险，只是不明白为什么一直不把以前预留的证书给删除。
</pre>
 
 
 </div>
 

 
 
 
 
 <div class="cursor_off vt issuecomment"
 id="hc50">
 <div style="float:right; margin-right:.3em; text-align:right">
 <span class="date" title="Fri Aug 22 08:12:10 2014">
 Aug 22, 2014
 </span>
 
 
 </div>
 
 
 
 
 
 
 
 
 
 
 <span class="author">
 
 <a name="c50" href="/p/goagent/issues/detail?id=14192#c50">#50</a>
 

 <a class="userlink"
 href="/u/115941899871341951311/">tonytan...@gmail.com</a
></span>
 
<pre>
#49楼是正确的。内置的证书本来是可信的，但是由于它的私钥（相当于密码）是公开在网上的，任何人都可以利用，所以就不可信了。删除后，重新生成的文件类似，但不相同。#48楼你的理解不完全，但是感谢你的认真。希望作者尽快做出更正。
</pre>
 
 
 </div>
 

 
 
 
 
 <div class="cursor_off vt issuecomment"
 id="hc52">
 <div style="float:right; margin-right:.3em; text-align:right">
 <span class="date" title="Fri Aug 22 08:51:28 2014">
 Aug 22, 2014
 </span>
 
 
 </div>
 
 
 
 
 
 
 
 
 
 
 <span class="author">
 
 <a name="c52" href="/p/goagent/issues/detail?id=14192#c52">#52</a>
 

 <a class="userlink"
 href="/u/117908535892401558177/">jingc...@gmail.com</a
></span>
 
<pre>
其实我早有这些担心，曾经也使用过自己做的根证书，但比较麻烦，需要对local/certs目录下的存在的证书进行签名。目前，比较安全的做法是对google账户使用两步验证，使用敏感网站时尽量不用GoAgent。
</pre>
 
 
 </div>
 

 
 
 
 
 <div class="cursor_off vt issuecomment"
 id="hc53">
 <div style="float:right; margin-right:.3em; text-align:right">
 <span class="date" title="Fri Aug 22 09:01:00 2014">
 Aug 22, 2014
 </span>
 
 
 </div>
 
 
 
 
 
 
 
 
 
 
 <span class="author">
 
 <a name="c53" href="/p/goagent/issues/detail?id=14192#c53">#53</a>
 

 <a class="userlink"
 href="/u/arbiterazzvx/">arbiterazzvx</a
></span>
 
<pre>
#52
删除ca.crt的同时删掉certs目录，并且mmc清理掉原来的ca
运行导入新ca就可以了
certs目录下的证书goagent会自动生成的

手机打字真烦
</pre>
 
 
 </div>
 

 
 
 
 
 <div class="cursor_off vt issuecomment"
 id="hc55">
 <div style="float:right; margin-right:.3em; text-align:right">
 <span class="date" title="Sat Aug 23 02:28:40 2014">
 Aug 23, 2014
 </span>
 
 
 </div>
 
 
 
 
 
 
 
 
 
 
 <span class="author">
 
 <a name="c55" href="/p/goagent/issues/detail?id=14192#c55">#55</a>
 

 <a class="userlink"
 href="/u/115941899871341951311/">tonytan...@gmail.com</a
></span>
 
<pre>
#54
没关系，这些技术层面的东西是挺复杂的。我这么不停的回应，也是怕其他人有跟你之前一样的误解。:)

只是不明白，这个问题关注度挺高的，phus.lu 和其它作者怎么还没有回应。当然，我也理解他们的忙碌，毕竟他们是用业余时间写的GoAgent。
</pre>
 
 
 </div>
 

 
 
 
 
 <div class="cursor_off vt issuecomment"
 id="hc56">
 <div style="float:right; margin-right:.3em; text-align:right">
 <span class="date" title="Sat Aug 23 07:39:46 2014">
 Aug 23, 2014
 </span>
 
 
 </div>
 
 
 
 
 
 
 
 
 
 
 <span class="author">
 
 <a name="c56" href="/p/goagent/issues/detail?id=14192#c56">#56</a>
 

 <a class="userlink"
 href="/u/phus.lu/">phus.lu</a
></span>
 
<pre>
1. 删除默认 CA.crt 会导致很多小白报证书相关 issue，之前尝试过，后来烦不胜烦。
2. 加强 cert 的判断的确需要做，这个问题我尽快修复。
</pre>
 
 
 </div>
 

 
 
 
 
 <div class="cursor_off vt issuecomment"
 id="hc57">
 <div style="float:right; margin-right:.3em; text-align:right">
 <span class="date" title="Sat Aug 23 07:42:18 2014">
 Aug 23, 2014
 </span>
 
 
 </div>
 
 
 
 
 
 
 
 
 
 
 <span class="author">
 
 <a name="c57" href="/p/goagent/issues/detail?id=14192#c57">#57</a>
 

 <a class="userlink"
 href="/u/115941899871341951311/">tonytan...@gmail.com</a
></span>
 
<pre>
谢谢Phus大神！关于1，为什么会报错呢？不是GoAgent会自动生成吗？（我的理解可能不完全，预先抱歉）
</pre>
 
 
 </div>
 

 
 
 
 
 <div class="cursor_off vt issuecomment"
 id="hc58">
 <div style="float:right; margin-right:.3em; text-align:right">
 <span class="date" title="Sat Aug 23 07:48:37 2014">
 Aug 23, 2014
 </span>
 
 
 </div>
 
 
 
 
 
 
 
 
 
 
 <span class="author">
 
 <a name="c58" href="/p/goagent/issues/detail?id=14192#c58">#58</a>
 

 <a class="userlink"
 href="/u/phus.lu/">phus.lu</a
></span>
 
<pre>
1. firefox 会缓存之前 rootca 证书和各个网站的证书，所以一更新 goagent 版本，重新生成的证书就会被 firefox 拒绝，这样会被描述成“goagent坏了再也翻不了墙”。
2. 类似上面的情形，在路由器或者 NAS 上部署了 goagent local, 一旦更新，所有的客户端（尤其移动端）都会“翻不了墙”。
3. 还有一些类似情况。
</pre>
 
 
 </div>
 

 
 
 
 
 <div class="cursor_off vt issuecomment"
 id="hc59">
 <div style="float:right; margin-right:.3em; text-align:right">
 <span class="date" title="Sat Aug 23 08:01:05 2014">
 Aug 23, 2014
 </span>
 
 
 </div>
 
 
 
 
 
 
 
 
 
 
 <span class="author">
 
 <a name="c59" href="/p/goagent/issues/detail?id=14192#c59">#59</a>
 

 <a class="userlink"
 href="/u/111417774546691146193/">fgo...@gmail.com</a
></span>
 
<pre>
其实很好解决的，以后发布新版本的时候就提供两种下载链接，一种是内置证书的，一种是不内置证书的。
</pre>
 
 
 </div>
 

 
 
 
 
 <div class="cursor_off vt issuecomment"
 id="hc60">
 <div style="float:right; margin-right:.3em; text-align:right">
 <span class="date" title="Sat Aug 23 08:56:09 2014">
 Aug 23, 2014
 </span>
 
 
 </div>
 
 
 
 
 
 
 
 
 
 
 <span class="author">
 
 <a name="c60" href="/p/goagent/issues/detail?id=14192#c60">#60</a>
 

 <a class="userlink"
 href="/u/106994617174002114900/">mygodstu...@gmail.com</a
></span>
 
<pre>
#58
新版为何要重新生成？用旧的就好了。（就我看来）
</pre>
 
 
 </div>
 

 
 
 
 
 <div class="cursor_off vt issuecomment"
 id="hc61">
 <div style="float:right; margin-right:.3em; text-align:right">
 <span class="date" title="Sat Aug 23 08:57:43 2014">
 Aug 23, 2014
 </span>
 
 
 </div>
 
 
 
 
 
 
 
 
 
 
 <span class="author">
 
 <a name="c61" href="/p/goagent/issues/detail?id=14192#c61">#61</a>
 

 <a class="userlink"
 href="/u/phus.lu/">phus.lu</a
></span>
 
<pre>
呃，绝大部分用户不会保存原来的证书的。
</pre>
 
 
 </div>
 

 
 
 
 
 <div class="cursor_off vt issuecomment"
 id="hc62">
 <div style="float:right; margin-right:.3em; text-align:right">
 <span class="date" title="Sun Aug 24 03:40:32 2014">
 Aug 24, 2014
 </span>
 
 
 </div>
 
 
 
 
 
 
 
 
 
 
 <span class="author">
 
 <a name="c62" href="/p/goagent/issues/detail?id=14192#c62">#62</a>
 

 <a class="userlink"
 href="/u/yfdyh000/">yfdyh000</a
></span>
 
<pre>
能否回应一下 <a href="https://github.com/goagent/goagent/pull/29" rel="nofollow">https://github.com/goagent/goagent/pull/29</a> ，我认为这可以解决#58的问题。
</pre>
 
 
 </div>
 

 
 
 
 
 <div class="cursor_off vt issuecomment"
 id="hc63">
 <div style="float:right; margin-right:.3em; text-align:right">
 <span class="date" title="Sun Aug 24 04:02:32 2014">
 Aug 24, 2014
 </span>
 
 
 </div>
 
 
 
 
 
 
 
 
 
 
 <span class="author">
 
 <a name="c63" href="/p/goagent/issues/detail?id=14192#c63">#63</a>
 

 <a class="userlink"
 href="/u/phus.lu/">phus.lu</a
></span>
 
<pre>
#62 会有新的问题。你可以翻一下 git history, 我记得 1.x 版本用的就是这个办法，后来也不行，依然被证书类的 issues 打扰。

总之，现在的这个办法可能不会让你们满意，但是目前为止是能够尽量降低证书类 issues 的办法。
</pre>
 
 
 </div>
 

 
 
 
 
 <div class="cursor_off vt issuecomment"
 id="hc64">
 <div style="float:right; margin-right:.3em; text-align:right">
 <span class="date" title="Tue Aug 26 04:38:50 2014">
 Aug 26, 2014
 </span>
 
 
 </div>
 
 
 
 
 
 
 
 
 
 
 <span class="author">
 
 <a name="c64" href="/p/goagent/issues/detail?id=14192#c64">#64</a>
 

 <a class="userlink"
 href="/u/107430179411044113424/">xuyh0...@gmail.com</a
></span>
 
<pre>
能不能根据电脑的一些硬件识别码来生成证书避免这个问题？
</pre>
 
 
 </div>
 

 
 
 
 
 <div class="cursor_off vt issuecomment"
 id="hc65">
 <div style="float:right; margin-right:.3em; text-align:right">
 <span class="date" title="Tue Aug 26 08:56:56 2014">
 Aug 26, 2014
 </span>
 
 
 </div>
 
 
 
 
 
 
 
 
 
 
 <span class="author">
 
 <a name="c65" href="/p/goagent/issues/detail?id=14192#c65">#65</a>
 

 <a class="userlink"
 href="/u/105724805268215631170/">uuu...@gmail.com</a
></span>
 
<pre>
这个问题确实是安全隐患。我更新版本都只更新修改过的文件，这样证书就不用更新，只要生成一次，然后导入各个客户端就可以了。

</pre>
 
 
 </div>
 

 
 
 
 
 <div class="cursor_off vt issuecomment"
 id="hc67">
 <div style="float:right; margin-right:.3em; text-align:right">
 <span class="date" title="Wed Aug 27 00:27:32 2014">
 Aug 27, 2014
 </span>
 
 
 </div>
 
 
 
 
 
 
 
 
 
 
 <span class="author">
 
 <a name="c67" href="/p/goagent/issues/detail?id=14192#c67">#67</a>
 

 <a class="userlink"
 href="/u/110419512487386367011/">saphirza...@gmail.com</a
></span>
 
<pre>
目前预留证书的方式是适当的
goagent通过gae直接访问外网，gae本身已经决定了goagent没有安全可言
goagent的优势就在于“快”，只要保持住这点优势不丢就可以了
投入精力去解决不可能解决的问题，有些得不偿失

为了防止goagent被盲目信任，滥用在非安全的方面，导致用户隐私泄露，甚而跨省
有必要在主页和软件启动时提出警示信息

真要关注隐私和安全，那就应该使用Whonix，即使是Whonix也不应滥用
</pre>
 
 
 </div>
 

 
 
 
 
 <div class="cursor_off vt issuecomment"
 id="hc70">
 <div style="float:right; margin-right:.3em; text-align:right">
 <span class="date" title="Wed Jun 10 16:30:45 2015">
 Jun 10, 2015
 </span>
 
 
 </div>
 
 
 
 
 
 
 
 
 
 
 <span class="author">
 
 <a name="c70" href="/p/goagent/issues/detail?id=14192#c70">#70</a>
 

 <a class="userlink"
 href="/u/102300648489126678681/">linhaico...@gmail.com</a
></span>
 
<pre>
关注..............................
</pre>
 
 
 </div>
 

 
 
 
 
 <div class="cursor_off vt issuecomment"
 id="hc71">
 <div style="float:right; margin-right:.3em; text-align:right">
 <span class="date" title="Wed Jun 10 16:38:21 2015">
 Jun 10, 2015
 </span>
 
 
 </div>
 
 
 
 
 
 
 
 
 
 
 <span class="author">
 
 <a name="c71" href="/p/goagent/issues/detail?id=14192#c71">#71</a>
 

 <a class="userlink"
 href="/u/114255133369633707531/">fh0205z...@gmail.com</a
></span>
 
<pre>
#70 在四处挖坟啊哈哈。
</pre>
 
 
 </div>
 

 
 
 
 
 <div class="cursor_off vt issuecomment"
 id="hc72">
 <div style="float:right; margin-right:.3em; text-align:right">
 <span class="date" title="Wed Jun 10 16:44:54 2015">
 Jun 10, 2015
 </span>
 
 
 </div>
 
 
 
 
 
 
 
 
 
 
 <span class="author">
 
 <a name="c72" href="/p/goagent/issues/detail?id=14192#c72">#72</a>
 

 <a class="userlink"
 href="/u/102300648489126678681/">linhaico...@gmail.com</a
></span>
 
<pre>
#71 最近关注goagent安全方面,居安思危嘛，哈哈
</pre>
 
 
 </div>
 

 
 
 
 
 <div class="cursor_off vt issuecomment"
 id="hc73">
 <div style="float:right; margin-right:.3em; text-align:right">
 <span class="date" title="Wed Jun 10 17:39:38 2015">
 Jun 10, 2015
 </span>
 
 
 </div>
 
 
 
 
 
 
 
 
 
 
 <span class="author">
 
 <a name="c73" href="/p/goagent/issues/detail?id=14192#c73">#73</a>
 

 <a class="userlink"
 href="/u/115941899871341951311/">tonytan...@gmail.com</a
></span>
 
<pre>
#72 我好久没用goagent了，今天突然来了一堆通知邮件，原来是你哈！让我想起了去年的一些趣事。。。谢谢了！
</pre>
 
 
 </div>
 

 
 
 
 
 <div class="cursor_off vt issuecomment"
 id="hc74">
 <div style="float:right; margin-right:.3em; text-align:right">
 <span class="date" title="Wed Jun 10 18:53:42 2015">
 Jun 10, 2015
 </span>
 
 
 </div>
 
 
 
 
 
 
 
 
 
 
 <span class="author">
 
 <a name="c74" href="/p/goagent/issues/detail?id=14192#c74">#74</a>
 

 <a class="userlink"
 href="/u/108063289147214719846/">zhangj...@gmail.com</a
></span>
 
<pre>
#67 不想泄漏隐私，不想跟钱有关的帐号被盗，不想被跨省，那就应该在goagent之外加上tor，这是实现个人信息安全的最简易的方案。
</pre>
 
 
 </div>
 


 


 </td>
 </tr>

</tbody>
</table>
<br>
<script type="text/javascript" src="https://ssl.gstatic.com/codesite/ph/10671232128890609530/js/dit_scripts.js"></script>



</div> 
<form name="delcom" action="delComment.do?q=&amp;can=2&amp;groupby=&amp;sort=&amp;colspec=ID+Opened+Reporter+Modified+Summary+Stars" method="POST">
 <input type="hidden" name="sequence_num" value="">
 <input type="hidden" name="mode" value="">
 <input type="hidden" name="id" value="14192">
 <input type="hidden" name="token" value="">
</form>

<div id="helparea"></div>
<script type="text/javascript">
 _onload();
 function delComment(sequence_num, delete_mode) {
 var f = document.forms["delcom"];
 f.sequence_num.value = sequence_num;
 f.mode.value = delete_mode;
 
 f.submit();
 return false;
 }
 
 _floatMetadata();
</script>
<script type="text/javascript" src="https://ssl.gstatic.com/codesite/ph/10671232128890609530/js/kibbles.js"></script>
<script type="text/javascript">
 _setupKibblesOnDetailPage(
 'https://code.google.com/p/goagent/issues/list?cursor\x3dgoagent%3A14192',
 '/p/goagent/issues/entry',
 '',
 '',
 '', 'goagent', 14192,
 false, false, codesite_token);
</script>
 
 
 
 <script type="text/javascript" src="https://ssl.gstatic.com/codesite/ph/10671232128890609530/js/ph_core.js"></script>
 
 
 
 
</div> 

<div id="footer" dir="ltr">
 <div class="text">
 <a href="/projecthosting/terms.html">Terms</a> -
 <a href="http://www.google.com/privacy.html">Privacy</a> -
 <a href="/p/support/">Project Hosting Help</a>
 </div>
</div>
 <div class="hostedBy" style="margin-top: -20px;">
 <span style="vertical-align: top;">Powered by <a href="http://code.google.com/projecthosting/">Google Project Hosting</a></span>
 </div>

 
 


 
 </body>
</html>

